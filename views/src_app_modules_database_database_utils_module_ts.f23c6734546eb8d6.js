"use strict";(self.webpackChunkih_portal=self.webpackChunkih_portal||[]).push([["src_app_modules_database_database_utils_module_ts"],{5545:(z,b,l)=>{l.r(b),l.d(b,{DatabaseUtilsModule:()=>x});var h=l(8692),p=l(3580),d=l(8239),o=l(92),u=l(8629),v=l(574),t=l(4537),_=l(1383),U=l(1815),y=l(7556),F=l(3406);function C(i,a){if(1&i&&(t.TgZ(0,"div",32),t._UZ(1,"i",33),t.TgZ(2,"div",34),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.initMsg,"")}}function L(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.name),t.xp6(1),t.hij(" ",e.table," ")}}function A(i,a){if(1&i&&(t.TgZ(0,"div",32),t._UZ(1,"i",33),t.TgZ(2,"div",34),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.initMsg,"")}}function q(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function w(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function N(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function $(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function M(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e),t.xp6(1),t.hij(" ",e.toUpperCase()," ")}}function I(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.deleteSelectedDataFromCouchDb())}),t._uU(1," Delete Selected Data From CouchDb "),t.qZA()}}function E(i,a){if(1&i&&(t.TgZ(0,"tbody")(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA()()()),2&i){const e=a.$implicit;t.xp6(3),t.Oqu(e.id),t.xp6(2),t.Oqu(e.rev),t.xp6(2),t.Oqu(e.zone.name),t.xp6(2),t.Oqu(e.site.name)}}const S=[{path:"",component:(()=>{class i{constructor(e,s,n,r,c){this.store=e,this.sync=s,this.auth=n,this.dbUtils=r,this.router=c,this.responseMsg="",this.foundedDataToDelete=[],this.selectedListToBeDelete=[],this.Districts$=[],this.Sites$=[],this.Zones$=[],this.Chws$=[],this.sites$=[],this.zones$=[],this.chws$=[],this.types$=["data","patients","families"],this.constMsg="Loading...",this.initMsg=this.constMsg,this.EntitiesList$=[],this.initEntity=[],this.roles=new v.G(this.store),this.roles.isSuperUser()||(location.href=this.auth.userValue()?.defaultRedirectUrl ?? '')}createEntitiesFilterFormGroup(){return new o.cw({entities:new o.NI([],[o.kI.required])})}dataListToDeleteFilterFormGroup(){return new o.cw({start_date:new o.NI("",[o.kI.required,o.kI.minLength(7)]),end_date:new o.NI("",[o.kI.required,o.kI.minLength(7)]),sources:new o.NI("Tonoudayo",[o.kI.required]),districts:new o.NI("",[o.kI.required]),sites:new o.NI("",[o.kI.required]),zones:new o.NI("",[o.kI.required]),chws:new o.NI("",[o.kI.required]),type:new o.NI("",[o.kI.required])})}ngOnInit(){this.EntitiesForm=this.createEntitiesFilterFormGroup(),this.dataListToDeleteForm=this.dataListToDeleteFilterFormGroup(),this.initAllData()}initAllData(){var e=this;return(0,d.Z)(function*(){e.isLoading=!0,e.initMsg="Chargement des Entities ...",e.dbUtils.getDatabaseEntities().subscribe(function(){var s=(0,d.Z)(function*(n){200==n.status&&(e.EntitiesList$=n.data),e.initMsg="Chargement des Districts ...",e.sync.getDistrictsList().subscribe(function(){var r=(0,d.Z)(function*(c){200==c.status&&(e.Districts$=c.data),e.initMsg="Chargement des Sites ...",e.sync.getSitesList().subscribe(function(){var f=(0,d.Z)(function*(g){200==g.status&&(e.Sites$=g.data),e.initMsg="Chargement des Zones ...",e.sync.getZonesList().subscribe(function(){var m=(0,d.Z)(function*(Z){200==Z.status&&(e.Zones$=Z.data),e.initMsg="Chargement des ASC ...",e.sync.getChwsList().subscribe(function(){var D=(0,d.Z)(function*(T){200==T.status&&(e.Chws$=T.data),e.isLoading=!1});return function(T){return D.apply(this,arguments)}}(),D=>{e.isLoading=!1,console.log(D.error)})});return function(Z){return m.apply(this,arguments)}}(),m=>{e.isLoading=!1,console.log(m.error)})});return function(g){return f.apply(this,arguments)}}(),f=>{e.isLoading=!1,console.log(f.error)})});return function(c){return r.apply(this,arguments)}}(),r=>{e.isLoading=!1,console.log(r.error)})});return function(n){return s.apply(this,arguments)}}(),s=>{e.isLoading=!1,console.log(s.error)})})()}EntitiesSelectedList(){var e=[];const s=u.FI.returnEmptyArrayIfNul(this.EntitiesForm.value.entities);this.initEntity=s;for(let n=0;n<this.EntitiesList$.length;n++){const r=this.EntitiesList$[n];s.includes(r.name)&&e.push(r)}return e}TruncateBd(){var e=this;const s=this.EntitiesSelectedList();s.length>0&&(this.responseMsg="",this.initMsg=this.constMsg,this.isEntityLoading=!0,this.dbUtils.truncateDatabase({procide:!0,entities:s}).subscribe(function(){var n=(0,d.Z)(function*(r){e.responseMsg=r.data.toString(),200==r.status&&(e.initEntity=[]),e.isEntityLoading=!1});return function(r){return n.apply(this,arguments)}}(),n=>{console.log(n.error),this.isEntityLoading=!1,this.responseMsg=n.toString()}))}getListOfDataToDeleteFromCouchDb(){var e=this;this.initMsg=this.constMsg,this.isLoading=!0,this.foundedDataToDelete=[],this.selectedListToBeDelete=[],this.responseMsg="",this.dbUtils.getDataToDeleteFromCouchDb(this.ParamsToFilter()).subscribe(function(){var s=(0,d.Z)(function*(n){if(200==n.status){e.foundedDataToDelete=n.data;for(let r=0;r<e.foundedDataToDelete.length;r++){const c=e.foundedDataToDelete[r];e.selectedListToBeDelete.push({_deleted:!0,_id:c.id,_rev:c.rev})}}else e.responseMsg=n.data;e.isLoading=!1});return function(n){return s.apply(this,arguments)}}(),s=>{console.log(s.error),this.isLoading=!1,this.responseMsg=s.toString()})}deleteSelectedDataFromCouchDb(){var e=this;this.initMsg=this.constMsg,this.responseMsg="",this.selectedListToBeDelete.length>0?this.dbUtils.deleteDataFromCouchDb(this.selectedListToBeDelete,this.dataListToDeleteForm.value.type).subscribe(function(){var s=(0,d.Z)(function*(n){200==n.status?(e.responseMsg="Done successfuly !",e.foundedDataToDelete=[],e.selectedListToBeDelete=[]):e.responseMsg="Problem with query, retry!"});return function(n){return s.apply(this,arguments)}}(),s=>{console.log(s),this.responseMsg="Error found when deleting ..."}):this.responseMsg="Not data provied!"}ParamsToFilter(){return{start_date:this.dataListToDeleteForm.value.start_date,end_date:this.dataListToDeleteForm.value.end_date,sources:u.FI.returnDataAsArray(this.dataListToDeleteForm.value.sources),districts:u.FI.returnDataAsArray(this.dataListToDeleteForm.value.districts),sites:u.FI.returnDataAsArray(this.dataListToDeleteForm.value.sites),zones:u.FI.returnDataAsArray(this.dataListToDeleteForm.value.zones),chws:u.FI.returnDataAsArray(this.dataListToDeleteForm.value.chws),type:this.dataListToDeleteForm.value.type,withDhis2Data:!1}}genarateSites(){this.sites$=[],this.zones$=[],this.chws$=[];const e=this.dataListToDeleteForm.value.districts;if(this.dataListToDeleteForm.value.sites="",this.dataListToDeleteForm.value.chws="",(0,u.Nf)(e))for(let s=0;s<this.Sites$.length;s++){const n=this.Sites$[s];(0,u.Nf)(n)&&e==n.district.id&&this.sites$.push(n)}else this.sites$=[]}genarateZones(){this.zones$=[],this.chws$=[];const e=this.dataListToDeleteForm.value.sites;if(this.dataListToDeleteForm.value.zones="",this.dataListToDeleteForm.value.chws="",(0,u.Nf)(e))for(let s=0;s<this.Zones$.length;s++){const n=this.Zones$[s];(0,u.Nf)(e)&&e==n.site.id&&this.zones$.push(n)}else this.zones$=[]}genarateChws(){this.chws$=[];const e=this.dataListToDeleteForm.value.zones;if(this.dataListToDeleteForm.value.chws="",(0,u.Nf)(e))for(let s=0;s<this.Chws$.length;s++){const n=this.Chws$[s];(0,u.Nf)(n)&&e==n.zone.id&&this.chws$.push(n)}else this.chws$=[]}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(_.u),t.Y36(U._),t.Y36(y.e),t.Y36(F.W),t.Y36(p.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-user"]],decls:105,vars:15,consts:[[2,"color","red"],[1,"content-header"],[1,"container-fluid"],[1,"card","card-info"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],[1,"card-header"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-4","col-6"],[1,"form-group"],["formControlName","entities","multiple","multiple",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","submit",1,"btn","btn-danger","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"col-sm-3","col-6"],["type","date","formControlName","start_date",1,"form-control"],["type","date","formControlName","end_date",1,"form-control"],["formControlName","districts",1,"form-control",3,"change"],["formControlName","sites",1,"form-control",3,"change"],["formControlName","zones",1,"form-control",3,"change"],["formControlName","chws",1,"form-control"],["formControlName","type",1,"form-control"],[1,"col-sm-2","col-6"],["type","submit",1,"btn","btn-warning","form-control",3,"disabled"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],["type","button","class","btn btn-warning",3,"click",4,"ngIf"],[1,"table","datatable"],[4,"ngFor","ngForOf"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],[3,"value"],["type","button",1,"btn","btn-warning",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.qZA(),t.TgZ(2,"section",1)(3,"div",2)(4,"h2"),t._uU(5,"Truncate Database"),t.qZA(),t.TgZ(6,"div",3)(7,"div",4),t.YNc(8,C,4,1,"div",5),t.TgZ(9,"div",6)(10,"form",7),t.NdJ("ngSubmit",function(){return s.TruncateBd()}),t.TgZ(11,"div",8)(12,"div",9)(13,"div",10)(14,"label"),t._uU(15,"Entities"),t.qZA(),t.TgZ(16,"select",11),t._UZ(17,"option",12),t.YNc(18,L,2,2,"option",13),t.qZA()()(),t.TgZ(19,"div",9)(20,"div",10)(21,"label"),t._uU(22,"."),t.qZA(),t.TgZ(23,"button",14),t._uU(24," Truncate Progres database "),t._UZ(25,"span",15),t.qZA()()()()()()()()()(),t.TgZ(26,"section",1)(27,"div",2)(28,"h2"),t._uU(29,"Delete Chws Data From Couch Database (Tonoudayo App)"),t.qZA(),t.TgZ(30,"div",3)(31,"div",4),t.YNc(32,A,4,1,"div",5),t.TgZ(33,"div",6)(34,"form",7),t.NdJ("ngSubmit",function(){return s.getListOfDataToDeleteFromCouchDb()}),t.TgZ(35,"div",8)(36,"div",16)(37,"div",10)(38,"label"),t._uU(39,"Date D\xe9but"),t.qZA(),t._UZ(40,"input",17),t.qZA()(),t.TgZ(41,"div",16)(42,"div",10)(43,"label"),t._uU(44,"Date Fin"),t.qZA(),t._UZ(45,"input",18),t.qZA()(),t.TgZ(46,"div",16)(47,"div",10)(48,"label"),t._uU(49,"District"),t.qZA(),t.TgZ(50,"select",19),t.NdJ("change",function(){return s.genarateSites()}),t._UZ(51,"option",12),t.YNc(52,q,2,2,"option",13),t.qZA()()(),t.TgZ(53,"div",16)(54,"div",10)(55,"label"),t._uU(56,"Site"),t.qZA(),t.TgZ(57,"select",20),t.NdJ("change",function(){return s.genarateZones()}),t._UZ(58,"option",12),t.YNc(59,w,2,2,"option",13),t.qZA()()(),t.TgZ(60,"div",16)(61,"div",10)(62,"label"),t._uU(63,"Zone"),t.qZA(),t.TgZ(64,"select",21),t.NdJ("change",function(){return s.genarateChws()}),t._UZ(65,"option",12),t.YNc(66,N,2,2,"option",13),t.qZA()()(),t.TgZ(67,"div",16)(68,"div",10)(69,"label"),t._uU(70,"Chw"),t.qZA(),t.TgZ(71,"select",22),t._UZ(72,"option",12),t.YNc(73,$,2,2,"option",13),t.qZA()()(),t.TgZ(74,"div",16)(75,"div",10)(76,"label"),t._uU(77,"Type"),t.qZA(),t.TgZ(78,"select",23),t._UZ(79,"option",12),t.YNc(80,M,2,2,"option",13),t.qZA()()(),t.TgZ(81,"div",24)(82,"div",10)(83,"label"),t._uU(84,"."),t.qZA(),t.TgZ(85,"button",25),t._uU(86," OK "),t._UZ(87,"span",15),t.qZA()()()()()()(),t.TgZ(88,"div",26),t._UZ(89,"div",27),t.TgZ(90,"div",28),t.YNc(91,I,2,0,"button",29),t._UZ(92,"br"),t.TgZ(93,"table",30)(94,"thead")(95,"tr")(96,"th"),t._uU(97,"ID"),t.qZA(),t.TgZ(98,"th"),t._uU(99,"REV"),t.qZA(),t.TgZ(100,"th"),t._uU(101,"Zone Name"),t.qZA(),t.TgZ(102,"th"),t._uU(103,"Site"),t.qZA()()(),t.YNc(104,E,10,4,"tbody",31),t.qZA()()()()()()),2&e&&(t.xp6(1),t.hij(" ",s.responseMsg," "),t.xp6(7),t.Q6J("ngIf",s.isEntityLoading),t.xp6(2),t.Q6J("formGroup",s.EntitiesForm),t.xp6(8),t.Q6J("ngForOf",s.EntitiesList$),t.xp6(5),t.Q6J("disabled",!s.EntitiesForm.valid&&s.initEntity.length<=0),t.xp6(9),t.Q6J("ngIf",s.isLoading),t.xp6(2),t.Q6J("formGroup",s.dataListToDeleteForm),t.xp6(18),t.Q6J("ngForOf",s.Districts$),t.xp6(7),t.Q6J("ngForOf",s.sites$),t.xp6(7),t.Q6J("ngForOf",s.zones$),t.xp6(7),t.Q6J("ngForOf",s.chws$),t.xp6(7),t.Q6J("ngForOf",s.types$),t.xp6(5),t.Q6J("disabled",!s.dataListToDeleteForm.valid),t.xp6(6),t.Q6J("ngIf",s.selectedListToBeDelete.length>0),t.xp6(13),t.Q6J("ngForOf",s.foundedDataToDelete))},dependencies:[h.sg,h.O5,o._Y,o.YN,o.Kr,o.Fj,o.EJ,o.K7,o.JJ,o.JL,o.sg,o.u],encapsulation:2}),i})(),data:{href:"database",icon:"fa fa-user",label:"DatabaseUtils",title:"DatabaseUtils"}}];let J=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[p.Bz.forChild(S),p.Bz]}),i})(),x=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[h.ez,o.UX,J]}),i})()}}]);