"use strict";(self.webpackChunkih_portal=self.webpackChunkih_portal||[]).push([[257],{3257:(y,m,r)=>{r.r(m),r.d(m,{ChwsManageModule:()=>F});var u=r(8692),g=r(3580),h=r(8239),o=r(92),c=r(8629),t=r(4537),p=r(3406),f=r(7556),C=r(1815);function Z(i,a){if(1&i&&(t.TgZ(0,"div",43),t._UZ(1,"i",44),t.TgZ(2,"div",45),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function v(i,a){if(1&i&&(t.TgZ(0,"option",46),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function w(i,a){if(1&i&&(t.TgZ(0,"option",46),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function b(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tbody")(1,"tr",47),t.NdJ("click",function(){const l=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.EditChwsZone(l))}),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA()()()}if(2&i){const e=a.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(e.zone.name)}}function T(i,a){if(1&i&&(t.TgZ(0,"div",43),t._UZ(1,"i",44),t.TgZ(2,"div",45),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function _(i,a){if(1&i&&(t.TgZ(0,"option",46),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}const M=[{path:"",redirectTo:"replacements",pathMatch:"full"},{path:"replacements",component:(()=>{class i{constructor(e,n,s,l){this.db=e,this.auth=n,this.sync=s,this.router=l,this.District$=[],this.Sites$=[],this.Zones$=[],this.district$=[],this.sites$=[],this.replacementChws$=[],this.isLoginForm=!1,this.isLoading1=!1,this.isLoading2=!1,this.LoadingMsg="Loading...",this.isEditMode=!1,this.message=""}activeSave(){throw new Error("Method not implemented.")}ngOnInit(){this.initAllData(),this.filterForm=this.createFilterFormGroup(),this.replacementChwsForm=this.createReplacementChwsFormGroup()}initAllData(){var e=this;return(0,h.Z)(function*(){e.sync.getDistrictsList().subscribe(n=>{200==n.status&&(e.District$=n.data),e.sync.getSitesList().subscribe(s=>{200==n.status&&(e.Sites$=s.data)},s=>console.log(s.error))},n=>console.log(n.error))})()}getReplacementChws(){this.isLoading1=!0;const e={districts:c.F.returnDataAsArray(this.filterForm.value.districts),sites:c.F.returnDataAsArray(this.filterForm.value.sites)};this.sync.getZonesList(e).subscribe(n=>{200==n.status&&(this.Zones$=n.data),this.sync.getChwsList(e).subscribe(s=>{if(this.replacementChws$=[],200==s.status)for(let l=0;l<s.data.length;l++){const d=s.data[l];d.name.includes("(R)")&&this.replacementChws$.push(d)}this.isLoading1=!1},s=>{console.log(s),this.isLoading1=!1})},n=>{console.log(n),this.isLoading1=!1})}EditChwsZone(e){this.isEditMode=!0,this.replacementChwsForm=this.createReplacementChwsFormGroup(e),this.selectedChw(e)}selectedChw(e){this.chw=e}updateChwsFacilityIdAndContactPlace(){return this.isLoading2=!0,this.db.updateUserFacilityContactPlace(this.replacementChwsForm.value).subscribe(e=>{this.message=e.message,this.getReplacementChws(),this.closeModal(),this.isLoading2=!1},e=>{this.message=e,this.isLoading2=!1,console.log(this.message)})}createFilterFormGroup(){return new o.cw({districts:new o.NI("",[o.kI.required]),sites:new o.NI("",[o.kI.required])})}createReplacementChwsFormGroup(e){return new o.cw({contact:new o.NI(null!=e?e.id:"",[o.kI.required]),parent:new o.NI(null!=e?e.zone.id:"",[o.kI.required]),new_parent:new o.NI("",[o.kI.required])},[this.MatchValidator("parent","new_parent")])}MatchValidator(e,n){return s=>{const l=s.get(e),d=s.get(n);return l&&d&&this.isEditMode&&l.value==d.value?{mismatch:!0}:null}}genarateSites(){const e=c.F.returnDataAsArray(this.filterForm.value.districts);if(this.sites$=[],c.F.notNull(e))for(let n=0;n<this.Sites$.length;n++){const s=this.Sites$[n];c.F.notNull(s)&&e.includes(s.district.id)&&this.sites$.push(s)}else this.sites$=[]}showModalToast(e,n){showToast(e,n),this.closeModal("close-delete-modal")}closeModal(e="close-modal"){$("#"+e).trigger("click")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(p.W),t.Y36(f.e),t.Y36(C._),t.Y36(g.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-chws_manage"]],decls:83,vars:13,consts:[[1,"page-title","card","card-primary","card-outline"],[1,"card-body"],[1,"fas","fa-user",2,"float","left"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-3","col-6"],[1,"form-group"],["formControlName","districts",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sites",1,"form-control"],[1,"col-sm-2","col-6"],["type","submit",1,"btn","btn-warning","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"page-content-wrap"],[1,"col-md-12"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],[1,"table","datatable"],[4,"ngFor","ngForOf"],["id","modal-default",1,"modal","fade"],[1,"modal-dialog"],["novalidate","",1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"modal-content"],[1,"modal-header"],["height","30","src","assets/logo/logo.png","alt","","srcset","",1,"modal-title"],[1,"login-box-msg",2,"text-align","center"],[1,"btn-warning"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"login-box-msg"],[1,"input-group","mb-3"],["id","new_parent","formControlName","new_parent",1,"form-control"],[1,"input-group-append"],[1,"input-group-text"],[1,"fas","fa-edit"],[1,"modal-footer","justify-content-between"],["id","close-modal","type","button","data-dismiss","modal",1,"btn","btn-default"],["type","submit",1,"btn","btn-warning",3,"disabled"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],[3,"value"],["data-toggle","modal","data-target","#modal-default",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3," Chws List"),t.qZA(),t.TgZ(4,"div",3),t.YNc(5,Z,4,1,"div",4),t.TgZ(6,"form",5),t.NdJ("ngSubmit",function(){return n.getReplacementChws()}),t.TgZ(7,"div",6)(8,"div",7)(9,"div",8)(10,"label"),t._uU(11,"District"),t.qZA(),t.TgZ(12,"select",9),t.NdJ("change",function(){return n.genarateSites()}),t._UZ(13,"option",10),t.YNc(14,v,2,2,"option",11),t.qZA()()(),t.TgZ(15,"div",7)(16,"div",8)(17,"label"),t._uU(18,"Site"),t.qZA(),t.TgZ(19,"select",12),t._UZ(20,"option",10),t.YNc(21,w,2,2,"option",11),t.qZA()()(),t.TgZ(22,"div",13)(23,"div",8)(24,"label"),t._uU(25,"."),t.qZA(),t.TgZ(26,"button",14),t._uU(27," OK "),t._UZ(28,"span",15),t.qZA()()()()()()()(),t.TgZ(29,"div",16)(30,"div",6)(31,"div",17)(32,"div",18),t._UZ(33,"div",19),t.TgZ(34,"div",20)(35,"table",21)(36,"thead")(37,"tr")(38,"th"),t._uU(39,"Chws"),t.qZA(),t.TgZ(40,"th"),t._uU(41,"Zone"),t.qZA()()(),t.YNc(42,b,6,2,"tbody",22),t.qZA()()()()()(),t.TgZ(43,"div",23)(44,"div",24)(45,"div",3),t.YNc(46,T,4,1,"div",4),t.TgZ(47,"form",25),t.NdJ("ngSubmit",function(){return n.updateChwsFacilityIdAndContactPlace()}),t.TgZ(48,"div",26)(49,"div",27),t._UZ(50,"img",28),t.TgZ(51,"strong",29)(52,"span",30),t._uU(53,"Modifier la zone"),t.qZA()(),t.TgZ(54,"button",31)(55,"span",32),t._uU(56,"\xd7"),t.qZA()()(),t.TgZ(57,"div",33)(58,"p",34)(59,"strong"),t._uU(60),t.qZA()(),t.TgZ(61,"p"),t._uU(62,"L'ASC remplacante "),t.TgZ(63,"strong"),t._uU(64),t.qZA(),t._uU(65," intervient pr\xe9sentement dans "),t.TgZ(66,"strong"),t._uU(67),t.qZA()(),t._UZ(68,"br"),t.TgZ(69,"p"),t._uU(70,"Selectionner une nouvelle zone d'intervention"),t.qZA(),t.TgZ(71,"div",35)(72,"select",36),t._UZ(73,"option",10),t.YNc(74,_,2,2,"option",11),t.qZA(),t.TgZ(75,"div",37)(76,"div",38),t._UZ(77,"span",39),t.qZA()()()(),t.TgZ(78,"div",40)(79,"button",41),t._uU(80,"Close"),t.qZA(),t.TgZ(81,"button",42),t._uU(82,"Modifier"),t.qZA()()()()()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",n.isLoading1),t.xp6(1),t.Q6J("formGroup",n.filterForm),t.xp6(8),t.Q6J("ngForOf",n.District$),t.xp6(7),t.Q6J("ngForOf",n.sites$),t.xp6(5),t.Q6J("disabled",!n.filterForm.valid),t.xp6(16),t.Q6J("ngForOf",n.replacementChws$),t.xp6(4),t.Q6J("ngIf",n.isLoading2),t.xp6(1),t.Q6J("formGroup",n.replacementChwsForm),t.xp6(13),t.Oqu(n.message),t.xp6(4),t.Oqu(null==n.chw?null:n.chw.name),t.xp6(3),t.Oqu(null==n.chw||null==n.chw.zone?null:n.chw.zone.name),t.xp6(7),t.Q6J("ngForOf",n.Zones$),t.xp6(7),t.Q6J("disabled",!n.replacementChwsForm.valid))},dependencies:[u.sg,u.O5,o._Y,o.YN,o.Kr,o.EJ,o.JJ,o.JL,o.sg,o.u],encapsulation:2}),i})(),data:{href:"replacements",icon:"fa fa-user",label:"Remplacants",title:"Remplacants"}}];let A=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[g.Bz.forChild(M),g.Bz]}),i})(),F=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[u.ez,o.UX,A]}),i})()}}]);