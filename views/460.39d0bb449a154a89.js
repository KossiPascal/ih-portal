"use strict";(self.webpackChunkih_portal=self.webpackChunkih_portal||[]).push([[460],{9460:(M,c,l)=>{l.r(c),l.d(c,{UsersModule:()=>w});var m=l(8692),p=l(3580),i=l(92),u=l(8629),e=l(4537),g=l(7556);function f(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"tbody")(1,"tr")(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td")(15,"i",58),e.NdJ("click",function(){const a=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.EditUser(a))}),e.qZA()(),e.TgZ(16,"td")(17,"i",59),e.NdJ("click",function(){const a=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.selectedUser(a))}),e.qZA()(),e.TgZ(18,"td")(19,"span",60),e._uU(20),e.qZA()(),e.TgZ(21,"td")(22,"span",60),e._uU(23),e.qZA()()()()}if(2&s){const t=r.$implicit,o=r.index;e.xp6(3),e.Oqu(t.id),e.xp6(2),e.Oqu(o+1),e.xp6(2),e.Oqu(t.username),e.xp6(2),e.Oqu(t.fullname),e.xp6(2),e.Oqu(t.email),e.xp6(2),e.Oqu(t.roles),e.xp6(7),e.Oqu(t.isActive?"":"\u2713"),e.xp6(3),e.Oqu(t.isSuperAdmin?"\u2713":"")}}function h(s,r){1&s&&(e.TgZ(0,"label",61),e._uU(1,"Username"),e.qZA())}function Z(s,r){1&s&&(e.TgZ(0,"label",62),e._uU(1,"Full Name"),e.qZA())}function U(s,r){1&s&&(e.TgZ(0,"label",63),e._uU(1,"Email"),e.qZA())}function _(s,r){1&s&&(e.TgZ(0,"label",64),e._uU(1,"Password"),e.qZA())}function v(s,r){1&s&&(e.TgZ(0,"label",65),e._uU(1,"Password COnfirm"),e.qZA())}function b(s,r){1&s&&(e.TgZ(0,"div",66),e._uU(1," Password does not match "),e.qZA())}function T(s,r){1&s&&(e.TgZ(0,"label",65),e._uU(1,"R\xf4les"),e.qZA())}function A(s,r){if(1&s&&(e.TgZ(0,"option",67),e._uU(1),e.qZA()),2&s){const t=r.$implicit;e.s9C("value",t),e.xp6(1),e.hij(" ",t," ")}}const q=[{path:"",component:(()=>{class s{constructor(t,o){this.auth=t,this.router=o,this.users$=[],this.roles$=["super_admin","can_manage_user","admin","visitor","can_send_dhis2","can_only_see"],this.isLoginForm=!1,this.isLoading=!1,this.LoadingMsg="Loading...",this.isEditMode=!1,this.message=""}activeSave(){throw new Error("Method not implemented.")}ngOnInit(){this.getUsers(),this.userForm=this.createFormGroup()}getUsers(){this.auth.getAllUsers().subscribe(t=>{if(200===t.status){this.users$=[];const o=t.data;for(let n=0;n<o.length;n++){const a=o[n];delete a.password,this.users$.push(a)}}else console.log(t.data)},t=>{console.log(t.error)})}EditUser(t){this.isEditMode=!0,t.roles=t.roles.toString().replace("[","").replace("]","").split(","),this.userForm=this.createFormGroup(t),this.selectedUser(t)}selectedUser(t){this.user=t}DeleteUser(){this.isEditMode=!1,this.user&&this.auth.deleteUser(this.user).subscribe(t=>{200===t.status?(this.showModalToast("success","Supprim\xe9 avec success"),console.log("successfully deleted!"),this.getUsers(),this.user=null,this.isLoading=!1):this.message=t.data,console.log(this.message)},t=>{this.message=t,this.isLoading=!1,console.log(this.message)})}CreateUser(){this.isEditMode=!1,this.userForm=this.createFormGroup(),this.user=null}createFormGroup(t){return new i.cw({username:new i.NI(null!=t?t.username:"",[i.kI.required,i.kI.minLength(4)]),fullname:new i.NI(null!=t?t.fullname:"",[i.kI.required,i.kI.minLength(4)]),email:new i.NI(null!=t?t.email:"",[i.kI.required,i.kI.email]),password:new i.NI("",this.isEditMode?[]:[i.kI.required,i.kI.minLength(8)]),passwordConfirm:new i.NI("",this.isEditMode?[]:[i.kI.required,i.kI.minLength(8)]),roles:new i.NI(null!=t?t.roles:"",[i.kI.required,i.kI.minLength(1)]),isActive:new i.NI(null!=t&&t.isActive),isSuperAdmin:new i.NI(null!=t&&t.isSuperAdmin)},[this.MatchValidator("password","passwordConfirm")])}passwordMatchError(){return this.userForm.getError("password")&&this.userForm.get("passwordConfirm")?.touched}showModalToast(t,o){showToast(t,o),this.closeModal("close-delete-modal")}closeModal(t="close-modal"){$("#"+t).trigger("click")}MatchValidator(t,o){return n=>{const a=n.get(t),d=n.get(o);if(a&&d){if(a.value!==d.value)return{mismatch:!0};if(this.isEditMode&&(u.F.notNull(a.value)&&a.value.length<8||u.F.notNull(d.value)&&d.value.length<8))return{mismatch:!0}}return null}}register(){if(this.auth.isLoggedIn()){if(this.isEditMode){const t=u.F.notNull(this.userForm.value.password)&&u.F.notNull(this.userForm.value.passwordConfirm);this.userForm.value.editPassword=t,this.userForm.value.id=this.user.id}return(this.isEditMode?this.auth.updateUser(this.userForm.value):this.auth.register(this.userForm.value)).subscribe(t=>{200===t.status?(this.message="Registed successfully !",this.closeModal(),console.log("successfully !"),this.getUsers()):this.message=t.data,console.log(this.message),this.isLoading=!1},t=>{this.isLoading=!1})}this.auth.logout()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(g.e),e.Y36(p.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-user"]],decls:125,vars:21,consts:[[1,"page-title","card","card-primary","card-outline"],[1,"card-body"],[1,"fas","fa-user",2,"float","left"],["type","button","data-toggle","modal","data-target","#modal-default",1,"btn","btn-default",2,"float","right",3,"click"],[1,"page-content-wrap"],[1,"row"],[1,"col-md-12"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],[1,"table","datatable"],["colspan","2"],[4,"ngFor","ngForOf"],["id","modal-default",1,"modal","fade"],[1,"modal-dialog"],["novalidate","",1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"modal-content"],[1,"modal-header"],["height","30","src","assets/logo/logo.png","alt","","srcset","",1,"modal-title"],[1,"login-box-msg",2,"text-align","center"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"login-box-msg"],["for","username",4,"ngIf"],[1,"input-group","mb-3"],["id","username","type","text","placeholder","Username","formControlName","username",1,"form-control"],[1,"input-group-append"],[1,"input-group-text"],[1,"fas","fa-user"],["for","fullname",4,"ngIf"],["id","fullname","type","text","placeholder","Full Name","formControlName","fullname",1,"form-control"],["for","email",4,"ngIf"],["id","email","type","email","placeholder","Email","formControlName","email",1,"form-control"],[1,"fas","fa-envelope"],["for","password",4,"ngIf"],["id","password","type","password","placeholder","Password","formControlName","password",1,"form-control"],[1,"fas","fa-lock"],["for","passwordConfirm",4,"ngIf"],["id","passwordConfirm","type","password","placeholder","Retype password","formControlName","passwordConfirm",1,"form-control"],["class","btn btn-danger",4,"ngIf"],["multiple","multiple","formControlName","roles",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-6"],[1,"icheck-primary"],["type","checkbox","id","isActive","formControlName","isActive"],["for","isActive"],["type","checkbox","id","isSuperAdmin","formControlName","isSuperAdmin"],["for","isSuperAdmin"],[1,"modal-footer","justify-content-between"],["id","close-modal","type","button","data-dismiss","modal",1,"btn","btn-default"],["type","submit",3,"disabled"],["id","modal-danger",1,"modal","fade"],[1,"modal-content","bg-danger"],[1,"modal-title"],["id","close-delete-modal","type","button","data-dismiss","modal","aria-label","Close",1,"close"],["type","button","data-dismiss","modal",1,"btn","btn-default"],["type","button",1,"btn","btn-danger","swalDefaultSuccess",3,"click"],["data-toggle","modal","data-target","#modal-default",1,"btn-warning","fas","fa-edit",3,"click"],["data-toggle","modal","data-target","#modal-danger",1,"btn-danger","fas","fa-trash-alt",3,"click"],[2,"font-size","20px"],["for","username"],["for","fullname"],["for","email"],["for","password"],["for","passwordConfirm"],[1,"btn","btn-danger"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3," Users List"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return o.CreateUser()}),e._uU(5," Add User "),e.qZA()()(),e.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7),e._UZ(10,"div",8),e.TgZ(11,"div",9)(12,"table",10)(13,"thead")(14,"tr")(15,"th"),e._uU(16,"id"),e.qZA(),e.TgZ(17,"th"),e._uU(18,"N\xb0"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Username"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Full name"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Email"),e.qZA(),e.TgZ(25,"th"),e._uU(26,"Role"),e.qZA(),e.TgZ(27,"th",11),e._uU(28,"Actions"),e.qZA(),e.TgZ(29,"th"),e._uU(30,"InActifs"),e.qZA(),e.TgZ(31,"th"),e._uU(32,"IsSuperAdmin"),e.qZA()()(),e.YNc(33,f,24,8,"tbody",12),e.qZA()()()()()(),e.TgZ(34,"div",13)(35,"div",14)(36,"form",15),e.NdJ("ngSubmit",function(){return o.register()}),e.TgZ(37,"div",16)(38,"div",17),e._UZ(39,"img",18),e.TgZ(40,"strong",19)(41,"span"),e._uU(42),e.qZA()(),e.TgZ(43,"button",20)(44,"span",21),e._uU(45,"\xd7"),e.qZA()()(),e.TgZ(46,"div",22)(47,"p",23)(48,"strong"),e._uU(49),e.qZA()(),e.YNc(50,h,2,0,"label",24),e.TgZ(51,"div",25),e._UZ(52,"input",26),e.TgZ(53,"div",27)(54,"div",28),e._UZ(55,"span",29),e.qZA()()(),e.YNc(56,Z,2,0,"label",30),e.TgZ(57,"div",25),e._UZ(58,"input",31),e.TgZ(59,"div",27)(60,"div",28),e._UZ(61,"span",29),e.qZA()()(),e.YNc(62,U,2,0,"label",32),e.TgZ(63,"div",25),e._UZ(64,"input",33),e.TgZ(65,"div",27)(66,"div",28),e._UZ(67,"span",34),e.qZA()()(),e.YNc(68,_,2,0,"label",35),e.TgZ(69,"div",25),e._UZ(70,"input",36),e.TgZ(71,"div",27)(72,"div",28),e._UZ(73,"span",37),e.qZA()()(),e.YNc(74,v,2,0,"label",38),e.TgZ(75,"div",25),e._UZ(76,"input",39),e.TgZ(77,"div",27)(78,"div",28),e._UZ(79,"span",37),e.qZA()()(),e.YNc(80,b,2,0,"div",40),e.YNc(81,T,2,0,"label",38),e.TgZ(82,"div",25)(83,"select",41),e.YNc(84,A,2,2,"option",42),e.qZA(),e.TgZ(85,"div",27)(86,"div",28),e._UZ(87,"span",37),e.qZA()()(),e.TgZ(88,"div",5)(89,"div",43)(90,"div",25)(91,"div",44),e._UZ(92,"input",45),e.TgZ(93,"label",46),e._uU(94,"Activer"),e.qZA()()()(),e.TgZ(95,"div",43)(96,"div",25)(97,"div",44),e._UZ(98,"input",47),e.TgZ(99,"label",48),e._uU(100,"isSuperAdmin"),e.qZA()()()()()(),e.TgZ(101,"div",49)(102,"button",50),e._uU(103,"Close"),e.qZA(),e.TgZ(104,"button",51),e._uU(105),e.qZA()()()()()(),e.TgZ(106,"div",52)(107,"div",14)(108,"div",53)(109,"div",17)(110,"h4",54),e._uU(111,"Suppression d'utilisateur"),e.qZA(),e.TgZ(112,"button",55)(113,"span",21),e._uU(114,"\xd7"),e.qZA()()(),e.TgZ(115,"div",22),e._uU(116," Cette action est ir\xe9versible! \xcates vous s\xfbr de proc\xe9der \xe0 la suppression ? "),e.TgZ(117,"p",23)(118,"strong"),e._uU(119),e.qZA()()(),e.TgZ(120,"div",49)(121,"button",56),e._uU(122,"Annuler"),e.qZA(),e.TgZ(123,"button",57),e.NdJ("click",function(){return o.DeleteUser()}),e._uU(124,"Oui Supprimer !"),e.qZA()()()()()),2&t&&(e.xp6(33),e.Q6J("ngForOf",o.users$),e.xp6(3),e.Q6J("formGroup",o.userForm),e.xp6(5),e.Gre(" btn-",o.isEditMode?"warning":"success",""),e.xp6(1),e.Oqu(o.isEditMode?"Modifier un utilisateur":"Ajouter un utilisateur"),e.xp6(7),e.Oqu(o.message),e.xp6(1),e.Q6J("ngIf",o.isEditMode),e.xp6(6),e.Q6J("ngIf",o.isEditMode),e.xp6(6),e.Q6J("ngIf",o.isEditMode),e.xp6(6),e.Q6J("ngIf",o.isEditMode),e.xp6(6),e.Q6J("ngIf",o.isEditMode),e.xp6(6),e.Q6J("ngIf",o.passwordMatchError()),e.xp6(1),e.Q6J("ngIf",o.isEditMode),e.xp6(3),e.Q6J("ngForOf",o.roles$),e.xp6(20),e.Gre("btn btn-",o.isEditMode?"warning":"success",""),e.Q6J("disabled",!o.userForm.valid),e.xp6(1),e.Oqu(o.isEditMode?"Modifier":"Sauvegarder"),e.xp6(14),e.Oqu(o.message))},dependencies:[m.sg,m.O5,i._Y,i.YN,i.Kr,i.Fj,i.Wl,i.K7,i.JJ,i.JL,i.sg,i.u],encapsulation:2}),s})(),data:{href:"user",icon:"fa fa-user",label:"Users",title:"Users"}}];let C=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[p.Bz.forChild(q),p.Bz]}),s})(),w=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[m.ez,i.UX,C]}),s})()}}]);