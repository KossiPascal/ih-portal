"use strict";(self.webpackChunkih_portal=self.webpackChunkih_portal||[]).push([["src_app_modules_manage-chws_manage-chws_module_ts"],{4100:(ke,I,p)=>{p.r(I),p.d(I,{ManageChwsModule:()=>Se});var v=p(8692),T=p(3580),x=p(4553),_=p(92),F=p(5128),l=p(8629),t=p(4537),S=p(3406),M=p(7556),A=p(3395);function k(i,r){if(1&i&&(t.TgZ(0,"b",35)(1,"strong"),t._uU(2),t.qZA()()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(e.message)}}function E(i,r){if(1&i&&(t.TgZ(0,"div",44),t._UZ(1,"i",45),t.TgZ(2,"div",46),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function Y(i,r){if(1&i&&(t.TgZ(0,"option",47),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function L(i,r){if(1&i&&(t.TgZ(0,"option",47),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function j(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"tbody")(1,"tr",48),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.EditChwsZone(o))}),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA()()()}if(2&i){const e=r.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(e.zone.name)}}function G(i,r){if(1&i&&(t.TgZ(0,"div",44),t._UZ(1,"i",45),t.TgZ(2,"div",46),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function K(i,r){if(1&i&&(t.TgZ(0,"option",47),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}let H=(()=>{class i{constructor(e,n,a,o){this.db=e,this.auth=n,this.sync=a,this.router=o,this.District$=[],this.Sites$=[],this.Zones$=[],this.district$=[],this.sites$=[],this.replacementChws$=[],this.isLoginForm=!1,this.isLoading1=!1,this.isLoading2=!1,this.LoadingMsg="Loading...",this.isEditMode=!1,this.message="",this.APP_LOGO=F.z.APP_LOGO}activeSave(){throw new Error("Method not implemented.")}ngOnInit(){this.initAllData(),this.filterForm=this.createFilterFormGroup(),this.replacementChwsForm=this.createReplacementChwsFormGroup()}initAllData(){var e=this;return(0,x.Z)(function*(){e.sync.getDistrictsList().subscribe(n=>{200==n.status&&(e.District$=n.data),e.sync.getSitesList().subscribe(a=>{200==a.status&&(e.Sites$=a.data)},a=>console.log(a.error))},n=>console.log(n.error))})()}getReplacementChws(){this.isLoading1=!0;const e={districts:(0,l.pb)(this.filterForm.value.districts),sites:(0,l.pb)(this.filterForm.value.sites),withDhis2Data:!1};this.sync.getZonesList(e).subscribe(n=>{200==n.status&&(this.Zones$=n.data),this.sync.getChwsList(e).subscribe(a=>{if(this.replacementChws$=[],200==a.status)for(let o=0;o<a.data.length;o++){const s=a.data[o];s.name.includes("(R)")&&this.replacementChws$.push(s)}this.isLoading1=!1},a=>{console.log(a),this.isLoading1=!1})},n=>{console.log(n),this.isLoading1=!1})}EditChwsZone(e){this.message="",this.isEditMode=!0,this.replacementChwsForm=this.createReplacementChwsFormGroup(e),this.selectedChw(e)}selectedChw(e){this.chw=e}updateChwsFacilityIdAndContactPlace(){return this.isLoading2=!0,this.message="",this.db.updateUserFacilityContactPlace(this.replacementChwsForm.value).subscribe(e=>{this.message=e.message,this.getReplacementChws(),this.closeModal(),this.isLoading2=!1},e=>{this.message=e,this.isLoading2=!1,console.log(this.message)})}createFilterFormGroup(){return new _.cw({districts:new _.NI("",[_.kI.required]),sites:new _.NI("",[_.kI.required])})}createReplacementChwsFormGroup(e){return new _.cw({contact:new _.NI(null!=e?e.id:"",[_.kI.required]),parent:new _.NI(null!=e?e.zone.id:"",[_.kI.required]),code:new _.NI(null!=e?e.external_id:"",[_.kI.required]),new_parent:new _.NI("",[_.kI.required])},[this.MatchValidator("parent","new_parent")])}MatchValidator(e,n){return a=>{const o=a.get(e),s=a.get(n);return o&&s&&this.isEditMode&&o.value==s.value?{mismatch:!0}:null}}genarateSites(){const e=(0,l.pb)(this.filterForm.value.districts);if(this.sites$=[],(0,l.Nf)(e))for(let n=0;n<this.Sites$.length;n++){const a=this.Sites$[n];(0,l.Nf)(a)&&e.includes(a.district.id)&&this.sites$.push(a)}else this.sites$=[]}showModalToast(e,n){showToast(e,n),this.closeModal("close-delete-modal")}closeModal(e="close-modal"){$("#"+e).trigger("click")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.W),t.Y36(M.e),t.Y36(A._),t.Y36(T.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-chws_manage"]],decls:87,vars:15,consts:[[1,"page-title","card","card-primary","card-outline"],[1,"card-body"],[1,"fas","fa-user",2,"float","left"],["class","login-box-msg",4,"ngIf"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-3","col-6"],[1,"form-group"],["formControlName","districts",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sites",1,"form-control"],[1,"col-sm-2","col-6"],["type","submit",1,"btn","btn-warning","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"page-content-wrap"],[1,"col-md-12"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],[1,"table","datatable"],[4,"ngFor","ngForOf"],["id","modal-default",1,"modal","fade"],[1,"modal-dialog"],["novalidate","",1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"modal-content"],[1,"modal-header"],["height","30","alt","","srcset","",1,"modal-title",3,"src"],[1,"login-box-msg",2,"text-align","center"],[1,"btn-warning"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"login-box-msg"],[1,"input-group","mb-3"],["id","new_parent","formControlName","new_parent",1,"form-control"],[1,"input-group-append"],[1,"input-group-text"],[1,"fas","fa-edit"],[1,"modal-footer","justify-content-between"],["id","close-modal","type","button","data-dismiss","modal",1,"btn","btn-default"],["type","submit",1,"btn","btn-warning",3,"disabled"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],[3,"value"],["data-toggle","modal","data-target","#modal-default",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3," List des ASC rempla\xe7antes"),t.qZA(),t._UZ(4,"br")(5,"br")(6,"br"),t.YNc(7,k,3,1,"b",3),t.TgZ(8,"div",4),t.YNc(9,E,4,1,"div",5),t.TgZ(10,"form",6),t.NdJ("ngSubmit",function(){return n.getReplacementChws()}),t.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"label"),t._uU(15,"District"),t.qZA(),t.TgZ(16,"select",10),t.NdJ("change",function(){return n.genarateSites()}),t._UZ(17,"option",11),t.YNc(18,Y,2,2,"option",12),t.qZA()()(),t.TgZ(19,"div",8)(20,"div",9)(21,"label"),t._uU(22,"Site"),t.qZA(),t.TgZ(23,"select",13),t._UZ(24,"option",11),t.YNc(25,L,2,2,"option",12),t.qZA()()(),t.TgZ(26,"div",14)(27,"div",9)(28,"label"),t._uU(29,"."),t.qZA(),t.TgZ(30,"button",15),t._uU(31," OK "),t._UZ(32,"span",16),t.qZA()()()()()()()(),t.TgZ(33,"div",17)(34,"div",7)(35,"div",18)(36,"div",19),t._UZ(37,"div",20),t.TgZ(38,"div",21)(39,"table",22)(40,"thead")(41,"tr")(42,"th"),t._uU(43,"Nom de l'ASC"),t.qZA(),t.TgZ(44,"th"),t._uU(45,"Zone Actuel"),t.qZA()()(),t.YNc(46,j,6,2,"tbody",23),t.qZA()()()()()(),t.TgZ(47,"div",24)(48,"div",25)(49,"div",4),t.YNc(50,G,4,1,"div",5),t.TgZ(51,"form",26),t.NdJ("ngSubmit",function(){return n.updateChwsFacilityIdAndContactPlace()}),t.TgZ(52,"div",27)(53,"div",28),t._UZ(54,"img",29),t.TgZ(55,"strong",30)(56,"span",31),t._uU(57,"Modifier la zone"),t.qZA()(),t.TgZ(58,"button",32)(59,"span",33),t._uU(60,"\xd7"),t.qZA()()(),t.TgZ(61,"div",34)(62,"p",35)(63,"strong"),t._uU(64),t.qZA()(),t.TgZ(65,"p"),t._uU(66,"L'ASC remplacante "),t.TgZ(67,"strong"),t._uU(68),t.qZA(),t._uU(69," intervient pr\xe9sentement dans "),t.TgZ(70,"strong"),t._uU(71),t.qZA()(),t._UZ(72,"br"),t.TgZ(73,"p"),t._uU(74,"Selectionner une nouvelle zone d'intervention"),t.qZA(),t.TgZ(75,"div",36)(76,"select",37),t._UZ(77,"option",11),t.YNc(78,K,2,2,"option",12),t.qZA(),t.TgZ(79,"div",38)(80,"div",39),t._UZ(81,"span",40),t.qZA()()()(),t.TgZ(82,"div",41)(83,"button",42),t._uU(84,"Close"),t.qZA(),t.TgZ(85,"button",43),t._uU(86,"Modifier"),t.qZA()()()()()()()),2&e&&(t.xp6(7),t.Q6J("ngIf",""!=n.message),t.xp6(2),t.Q6J("ngIf",n.isLoading1),t.xp6(1),t.Q6J("formGroup",n.filterForm),t.xp6(8),t.Q6J("ngForOf",n.District$),t.xp6(7),t.Q6J("ngForOf",n.sites$),t.xp6(5),t.Q6J("disabled",!n.filterForm.valid),t.xp6(16),t.Q6J("ngForOf",n.replacementChws$),t.xp6(4),t.Q6J("ngIf",n.isLoading2),t.xp6(1),t.Q6J("formGroup",n.replacementChwsForm),t.xp6(3),t.s9C("src",n.APP_LOGO,t.LSH),t.xp6(10),t.Oqu(n.message),t.xp6(4),t.Oqu(null==n.chw?null:n.chw.name),t.xp6(3),t.Oqu(null==n.chw||null==n.chw.zone?null:n.chw.zone.name),t.xp6(7),t.Q6J("ngForOf",n.Zones$),t.xp6(7),t.Q6J("disabled",!n.replacementChwsForm.valid))},dependencies:[v.sg,v.O5,_._Y,_.YN,_.Kr,_.EJ,_.JJ,_.JL,_.sg,_.u],encapsulation:2}),i})();var P=p(3514),O=p(8527),Q=p(926);function V(i,r){if(1&i&&(t.TgZ(0,"div",21),t._UZ(1,"i",22),t.TgZ(2,"div",23),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.initMsg," ")}}function z(i,r){if(1&i&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.labelFR," ")}}function B(i,r){if(1&i&&(t.TgZ(0,"select",24),t.YNc(1,z,2,2,"option",25),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.Months$)}}function R(i,r){if(1&i&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e),t.xp6(1),t.hij(" ",e," ")}}function X(i,r){if(1&i&&(t.TgZ(0,"select",27),t.YNc(1,R,2,2,"option",25),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.Years$)}}function W(i,r){if(1&i&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function tt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"select",29),t.NdJ("change",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.genarateSites())}),t.YNc(1,W,2,2,"option",25),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.Districts$)}}function et(i,r){if(1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"District"),t.qZA(),t.YNc(4,tt,2,1,"select",28),t.qZA()()),2&i){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.Districts$.length>0)}}function nt(i,r){if(1&i&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function it(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"Site"),t.qZA(),t.TgZ(4,"select",30),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.genarateChws())}),t._UZ(5,"option",31),t.YNc(6,nt,2,2,"option",25),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.site$)}}function at(i,r){if(1&i&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function ot(i,r){if(1&i&&(t.TgZ(0,"div",32)(1,"div",10)(2,"label"),t._uU(3,"ASC"),t.qZA(),t.TgZ(4,"select",33),t._UZ(5,"option",31),t.YNc(6,at,2,2,"option",25),t.qZA()()()),2&i){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.chw$)}}function rt(i,r){if(1&i&&(t.TgZ(0,"option",26),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function st(i,r){if(1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"Annee CMM"),t.qZA(),t.TgZ(4,"select",34),t.YNc(5,rt,2,2,"option",25),t.qZA()()()),2&i){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.yearCmmMonthStartList$)}}function _t(i,r){1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"Calcul CMM"),t.qZA(),t.TgZ(4,"select",35)(5,"option",36),t._uU(6,"CMM * 1"),t.qZA(),t.TgZ(7,"option",37),t._uU(8,"CMM * 2"),t.qZA(),t.TgZ(9,"option",38),t._uU(10,"CMM * 3"),t.qZA(),t.TgZ(11,"option",39),t._uU(12,"CMM * 4"),t.qZA()()()())}function ct(i,r){if(1&i&&(t.TgZ(0,"h2")(1,"div",2)(2,"div",40),t._uU(3),t.qZA()()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.data_error_messages," ")}}function dt(i,r){1&i&&(t.TgZ(0,"h2")(1,"div",2)(2,"div",40),t._uU(3," Pas de donn\xe9es trouv\xe9e avec les paramettres renseign\xe9s ! "),t.qZA()()())}function lt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"ul")(1,"li")(2,"span",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.excel("export_table"+a))}),t._uU(3,"Excel"),t.qZA()(),t.TgZ(4,"li")(5,"span",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.csv("export_table"+a))}),t._uU(6,"CSV"),t.qZA()(),t.TgZ(7,"li")(8,"span",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.json("export_table"+a))}),t._uU(9,"JSON"),t.qZA()(),t.TgZ(10,"li")(11,"span",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.pdf("export_table"+a))}),t._uU(12,"PDF"),t.qZA()(),t.TgZ(13,"li")(14,"span",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.print("export_table"+a))}),t._uU(15,"PRINT"),t.qZA()()()}}function ut(i,r){1&i&&t._UZ(0,"i",58)}function gt(i,r){if(1&i&&(t.TgZ(0,"button",56),t.YNc(1,ut,1,0,"i",57),t._uU(2),t.qZA()),2&i){const e=t.oxw().index,n=t.oxw(2);t.Q6J("disabled","true"==n.isUpdateLoading[e]),t.xp6(1),t.Q6J("ngIf","true"==n.isUpdateLoading[e]),t.xp6(1),t.hij(" ","true"==n.isUpdateLoading[e]?"Sauvegarde en cours ...":"Mettre \xe0 jour"," ")}}function pt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.editCmmClick(a))}),t.qZA()}if(2&i){const e=t.oxw().index,n=t.oxw(2);t.Gre("fas ","edit"==n.editCmm[e]?"fa-times":"fa-edit","")}}function mt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.editQtyValidatedClick(a))}),t.qZA()}if(2&i){const e=t.oxw().index,n=t.oxw(2);t.Gre("fas ","edit"==n.editQtyValidated[e]?"fa-times":"fa-edit","")}}function ht(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.editQtyDeliveredClick(a))}),t.qZA()}if(2&i){const e=t.oxw().index,n=t.oxw(2);t.Gre("fas ","edit"==n.editQtyDelivered[e]?"fa-times":"fa-edit","")}}function ft(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().index,o=t.oxw(2);return t.KtG(o.editObservationsClick(a))}),t.qZA()}if(2&i){const e=t.oxw().index,n=t.oxw(2);t.Gre("fas ","edit"==n.editObservations[e]?"fa-times":"fa-edit","")}}const vt=function(i){return{color:i}};function xt(i,r){if(1&i&&(t.TgZ(0,"p")(1,"span",64),t._uU(2),t.qZA()()),2&i){const e=r.ngIf;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,vt,e.color)),t.xp6(1),t.Oqu(e.value)}}function Zt(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw().ngIf,n=t.oxw(6);t.xp6(1),t.hij(" ",n.convertQty(e.year_chw_cmm)," ")}}function Ct(i,r){if(1&i&&t._UZ(0,"input",65),2&i){const e=t.oxw().ngIf,n=t.oxw().ngIf,a=t.oxw(3).index,o=t.oxw(2);t.hYB("id","year_chw_cmm_",a,"_",n,""),t.s9C("value",e.year_chw_cmm),t.Q6J("disabled","true"==o.isUpdateLoading[a]),t.uIk("data-drug-index",n)}}function wt(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw().ngIf,n=t.oxw(6);t.xp6(1),t.hij(" ",n.convertQty(e.quantity_validated)," ")}}function bt(i,r){if(1&i&&t._UZ(0,"input",65),2&i){const e=t.oxw().ngIf,n=t.oxw().ngIf,a=t.oxw(3).index,o=t.oxw(2);t.hYB("id","quantity_validated_",a,"_",n,""),t.s9C("value",e.quantity_validated),t.Q6J("disabled","true"==o.isUpdateLoading[a]),t.uIk("data-drug-index",n)}}function Tt(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw().ngIf,n=t.oxw(6);t.xp6(1),t.hij(" ",n.convertQty(e.delivered_quantity)," ")}}function yt(i,r){if(1&i&&t._UZ(0,"input",65),2&i){const e=t.oxw().ngIf,n=t.oxw().ngIf,a=t.oxw(3).index,o=t.oxw(2);t.hYB("id","delivered_quantity_",a,"_",n,""),t.s9C("value",e.delivered_quantity),t.Q6J("disabled","true"==o.isUpdateLoading[a]),t.uIk("data-drug-index",n)}}function Ut(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",66),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().ngIf,o=t.oxw(6);return t.KtG(o.BorrowingLendingShowHideMsg(a.borrowing_chws_code,a.lending_chws_code))}),t.qZA()}}function Dt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",66),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().ngIf,o=t.oxw(6);return t.KtG(o.showHideMsg(a.comments))}),t.qZA()}}function qt(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw().ngIf;t.xp6(1),t.hij(" ",e.observations," ")}}function Mt(i,r){if(1&i&&t._UZ(0,"input",67),2&i){const e=t.oxw().ngIf,n=t.oxw().ngIf,a=t.oxw(3).index,o=t.oxw(2);t.hYB("id","observations_",a,"_",n,""),t.s9C("value",e.observations),t.Q6J("disabled","true"==o.isUpdateLoading[a]),t.uIk("data-drug-index",n)}}function At(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",66),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().ngIf,o=t.oxw(6);return t.KtG(o.showHideMsg(a.observations))}),t.qZA()}}function Pt(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"tr")(2,"td")(3,"b"),t._uU(4),t.qZA()(),t.TgZ(5,"td",59)(6,"label")(7,"b"),t._uU(8),t.qZA()()(),t.TgZ(9,"td",59)(10,"p"),t._uU(11),t.qZA()(),t.TgZ(12,"td",59)(13,"p"),t._uU(14),t.qZA()(),t.TgZ(15,"td",59)(16,"p"),t._uU(17),t.qZA()(),t.TgZ(18,"td",59)(19,"p"),t._uU(20),t.qZA()(),t.TgZ(21,"td",59)(22,"p"),t._uU(23),t.qZA()(),t.TgZ(24,"td",59)(25,"p"),t._uU(26),t.qZA()(),t.TgZ(27,"td",59),t.YNc(28,xt,3,4,"p",20),t.qZA(),t.TgZ(29,"td",59)(30,"p"),t.YNc(31,Zt,2,1,"span",20),t.YNc(32,Ct,1,5,"input",60),t.qZA()(),t.TgZ(33,"td",59)(34,"p"),t._uU(35),t.qZA()(),t.TgZ(36,"td",59)(37,"p"),t._uU(38),t.qZA()(),t.TgZ(39,"td",59)(40,"p"),t.YNc(41,wt,2,1,"span",20),t.YNc(42,bt,1,5,"input",60),t.qZA()(),t.TgZ(43,"td",59)(44,"p"),t.YNc(45,Tt,2,1,"span",20),t.YNc(46,yt,1,5,"input",60),t.qZA()(),t.TgZ(47,"td",59)(48,"p"),t._uU(49),t.qZA()(),t.TgZ(50,"td",59)(51,"p"),t._uU(52),t.qZA()(),t.TgZ(53,"td",59)(54,"p"),t._uU(55),t.qZA()(),t.TgZ(56,"td",61)(57,"p"),t._uU(58),t.qZA(),t.YNc(59,Ut,1,0,"i",62),t.qZA(),t.TgZ(60,"td",59)(61,"p"),t._uU(62),t.qZA()(),t.TgZ(63,"td",59)(64,"p"),t._uU(65),t.qZA()(),t.TgZ(66,"td",59)(67,"p"),t._uU(68),t.qZA()(),t.TgZ(69,"td",59)(70,"p"),t._uU(71),t.qZA()(),t.TgZ(72,"td",59)(73,"p"),t._uU(74),t.qZA()(),t.TgZ(75,"td",61)(76,"p"),t._uU(77),t.qZA(),t.YNc(78,Dt,1,0,"i",62),t.qZA(),t.TgZ(79,"td",61),t.YNc(80,qt,2,1,"span",20),t.YNc(81,Mt,1,5,"input",63),t.YNc(82,At,1,0,"i",62),t.qZA()(),t.BQk()),2&i){const e=r.ngIf,n=t.oxw().ngIf,a=t.oxw().ngIf,o=t.oxw(2).index,s=t.oxw(2);t.xp6(4),t.Oqu(n),t.xp6(4),t.Oqu(s.getLabel(a.key)),t.xp6(3),t.Oqu(s.convertQty(e.month_quantity_beginning)),t.xp6(3),t.Oqu(s.convertQty(e.month_quantity_received)),t.xp6(3),t.Oqu(s.convertQty(e.month_total_quantity)),t.xp6(3),t.Oqu(s.convertQty(e.month_consumption)),t.xp6(3),t.Oqu(s.convertQty(e.theoretical_quantity)),t.xp6(3),t.Oqu(s.convertQty(e.inventory_quantity)),t.xp6(2),t.Q6J("ngIf",s.EcartColor(e)),t.xp6(3),t.Q6J("ngIf","edit"!=s.editCmm[o]),t.xp6(1),t.Q6J("ngIf",s.roles.canUpdateChwsDrug()&&"edit"==s.editCmm[o]),t.xp6(3),t.Oqu(s.convertQty(e.theoretical_quantity_to_order)),t.xp6(3),t.hij("",s.convertQty(e.quantity_to_order)," "),t.xp6(3),t.Q6J("ngIf","edit"!=s.editQtyValidated[o]),t.xp6(1),t.Q6J("ngIf",s.roles.canUpdateChwsDrug()&&"edit"==s.editQtyValidated[o]),t.xp6(3),t.Q6J("ngIf","edit"!=s.editQtyDelivered[o]),t.xp6(1),t.Q6J("ngIf",s.roles.canUpdateChwsDrug()&&"edit"==s.editQtyDelivered[o]),t.xp6(3),t.Oqu(e.satisfaction_rate),t.xp6(3),t.hij("",s.convertQty(e.borrowing_quantity)," "),t.xp6(3),t.hij("",s.convertQty(e.lending_quantity)," "),t.xp6(3),t.AsE("",e.borrowing_chws_code," ",e.lending_chws_code,""),t.xp6(1),t.Q6J("ngIf",""!=e.borrowing_chws_code||""!=e.lending_chws_code),t.xp6(3),t.Oqu(s.convertQty(e.quantity_loss)),t.xp6(3),t.hij("",s.convertQty(e.quantity_damaged)," "),t.xp6(3),t.hij("",s.convertQty(e.quantity_broken)," "),t.xp6(3),t.hij("",s.convertQty(e.quantity_expired)," "),t.xp6(3),t.Oqu(s.convertQty(e.other_quantity)),t.xp6(3),t.Oqu(e.comments),t.xp6(1),t.Q6J("ngIf",""!=e.comments),t.xp6(2),t.Q6J("ngIf","edit"!=s.editObservations[o]),t.xp6(1),t.Q6J("ngIf",s.roles.canUpdateChwsDrug()&&"edit"==s.editObservations[o]),t.xp6(1),t.Q6J("ngIf",""!=e.observations)}}function It(i,r){if(1&i&&(t.ynx(0),t.YNc(1,Pt,83,33,"ng-container",20),t.BQk()),2&i){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",e.val)}}function Ot(i,r){if(1&i&&(t.ynx(0),t.YNc(1,It,2,1,"ng-container",20),t.BQk()),2&i){const e=r.ngIf,n=t.oxw(4);t.xp6(1),t.Q6J("ngIf",n.getKey(e.key))}}function Qt(i,r){if(1&i&&(t.ynx(0),t.YNc(1,Ot,2,1,"ng-container",20),t.BQk()),2&i){const e=r.$implicit,n=t.oxw().$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("ngIf",a.toChwsDrugData(a.sortedArray(n.data),e))}}function Nt(i,r){1&i&&(t.TgZ(0,"p"),t._UZ(1,"br")(2,"br"),t.qZA())}function $t(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div"),t._UZ(1,"div",42),t.TgZ(2,"form",43),t.NdJ("submit",function(a){const s=t.CHM(e).index,c=t.oxw(2);return t.KtG(c.saveOrUpdate(a,s))}),t.TgZ(3,"div",44)(4,"div",6)(5,"div",45)(6,"p",46),t._uU(7),t.TgZ(8,"strong"),t._uU(9),t.qZA(),t._uU(10),t.qZA(),t.YNc(11,lt,16,0,"ul",20),t.YNc(12,gt,3,3,"button",47),t.qZA()(),t.TgZ(13,"div",48)(14,"table",49)(15,"thead")(16,"tr",50)(17,"th",51),t._uU(18,"Id"),t.qZA(),t.TgZ(19,"th",51),t._uU(20,"MEG"),t.qZA(),t.TgZ(21,"th",51),t._uU(22," Quantit\xe9 d\xe9but du mois "),t._UZ(23,"br"),t.TgZ(24,"small")(25,"small"),t._uU(26,"ou la quantit\xe9 \xe0 l'inventaire pr\xe9c\xe9dent"),t.qZA(),t._uU(27,"(A)"),t.qZA()(),t.TgZ(28,"th",51),t._uU(29,"Quantit\xe9 re\xe7ue au cours du mois "),t.TgZ(30,"small"),t._uU(31,"(B)"),t.qZA()(),t.TgZ(32,"th",51),t._uU(33,"Quantit\xe9 totale du mois "),t.TgZ(34,"small"),t._uU(35,"(C) C=A+B"),t.qZA()(),t.TgZ(36,"th",51),t._uU(37,"Consommation mensuelle du mois "),t.TgZ(38,"small"),t._uU(39,"(D)"),t.qZA()(),t.TgZ(40,"th",51),t._uU(41,"Quantit\xe9 th\xe9orique disponible \xe0 l'inventaire "),t.TgZ(42,"small"),t._uU(43,"E= C-D"),t.qZA()(),t.TgZ(44,"th",51),t._uU(45,"Quantit\xe9 compt\xe9e \xe0 l'inventaire "),t.TgZ(46,"small"),t._uU(47,"(F)"),t.qZA()(),t.TgZ(48,"th",51),t._uU(49,"Ecart d'inventaire "),t.TgZ(50,"small"),t._uU(51,"J = F-E"),t.qZA()(),t.TgZ(52,"th",51),t._uU(53,"CMM de l'ann\xe9e N-1 "),t._UZ(54,"br"),t.TgZ(55,"span",52),t._uU(56),t.qZA(),t._UZ(57,"br"),t.TgZ(58,"small"),t._uU(59,"(G)"),t.qZA(),t.YNc(60,pt,1,3,"i",53),t.qZA(),t.TgZ(61,"th",51),t._uU(62," Quantit\xe9 th\xe9orique \xe0 commander "),t.TgZ(63,"small"),t._uU(64),t.qZA()(),t.TgZ(65,"th",51),t._uU(66,"Quantit\xe9s \xe0 commander "),t._UZ(67,"br"),t.TgZ(68,"small")(69,"small"),t._uU(70,"(Expression besoins ASC)"),t.qZA(),t._uU(71,"(I)"),t.qZA()(),t.TgZ(72,"th",51),t._uU(73,"Quantit\xe9 valid\xe9e "),t.YNc(74,mt,1,3,"i",53),t.qZA(),t.TgZ(75,"th",51),t._uU(76,"Quantit\xe9 livr\xe9e "),t.YNc(77,ht,1,3,"i",53),t.qZA(),t.TgZ(78,"th",51),t._uU(79,"Taux de satisfaction"),t.qZA(),t.TgZ(80,"th",54),t._uU(81,"Observation ASC"),t.qZA(),t.TgZ(82,"th",51),t._uU(83,"Observations (Pharmacie) "),t.YNc(84,ft,1,3,"i",53),t.qZA()(),t.TgZ(85,"tr",50)(86,"th"),t._uU(87,"Quantit\xe9 Emprunt du mois"),t.qZA(),t.TgZ(88,"th"),t._uU(89,"Quantit\xe9 Pr\xeat du mois"),t.qZA(),t.TgZ(90,"th"),t._uU(91,"(Emprunt/Pr\xeat) Nom & Code ASC"),t.qZA(),t.TgZ(92,"th"),t._uU(93,"Perte du mois"),t.qZA(),t.TgZ(94,"th"),t._uU(95,"Avari\xe9 du mois"),t.qZA(),t.TgZ(96,"th"),t._uU(97,"Cass\xe9 du mois"),t.qZA(),t.TgZ(98,"th"),t._uU(99,"P\xe9rim\xe9 du mois"),t.qZA(),t.TgZ(100,"th"),t._uU(101,"Autres sortie du mois"),t.qZA(),t.TgZ(102,"th"),t._uU(103,"Commentaires ASC"),t.qZA()()(),t.TgZ(104,"tbody"),t.YNc(105,Qt,2,1,"ng-container",41),t.qZA()()()()(),t.YNc(106,Nt,3,0,"p",20),t.qZA()}if(2&i){const e=r.$implicit,n=r.index,a=t.oxw(2);t.xp6(1),t.MGl("id","data-info-",n,""),t.uIk("data-district",e.chw.site.district.id)("data-site",e.chw.site.id)("data-chw",e.chw.id),t.xp6(6),t.AsE("",e.chw.site.district.name," > ",e.chw.site.name," > "),t.xp6(2),t.Oqu(e.chw.name),t.xp6(1),t.hij(" ( ",e.chw.external_id," ) "),t.xp6(1),t.Q6J("ngIf",a.roles.canDownloadReports()&&"edit"!=a.editCmm[n]&&"edit"!=a.editQtyValidated[n]&&"edit"!=a.editQtyDelivered[n]&&"edit"!=a.editObservations[n]),t.xp6(1),t.Q6J("ngIf",a.roles.canUpdateChwsDrug()&&"edit"==a.editCmm[n]||"edit"==a.editQtyValidated[n]||"edit"==a.editQtyDelivered[n]||"edit"==a.editObservations[n]||"true"==a.isUpdateLoading[n]),t.xp6(2),t.Q6J("id","export_table"+n),t.xp6(42),t.Oqu(a.yearCmmMonthStart.name),t.xp6(4),t.Q6J("ngIf",a.roles.canUpdateChwsDrug()),t.xp6(4),t.hij("(H) H= ",a.chwsDrugDataForm.value.cmm_mutipliation," * F - G"),t.xp6(10),t.Q6J("ngIf",a.roles.canUpdateChwsDrug()),t.xp6(3),t.Q6J("ngIf",a.roles.canUpdateChwsDrug()),t.xp6(7),t.Q6J("ngIf",a.roles.canUpdateChwsDrug()),t.xp6(21),t.Q6J("ngForOf",a.objectKeys(e.data)),t.xp6(1),t.Q6J("ngIf",n<a.FinalChwsOutputData$.length-1)}}function Jt(i,r){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,$t,107,19,"div",41),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.FinalChwsOutputData$)}}let Ft=(()=>{class i{constructor(e,n,a){this.auth=e,this.sync=n,this.router=a,this.roles=new O.G(this.auth),this.data_error_messages="",this.data_no_data_found=!1,this.FinalChwsOutputData$=[],this.selectedChwData=null,this.ChwsDataFromDbError="",this.dataDetail="",this.Districts$=[],this.Sites$=[],this.Chws$=[],this.Months$=[],this.Years$=[],this.chw$=[],this.site$=[],this.drugUpdateErrorMsg="",this.isUpdateLoading=[],this.editCmm=[],this.editQtyValidated=[],this.editQtyDelivered=[],this.editObservations=[],this.isNumber=o=>!isNaN(2),this.showClass=o=>this.isNumber(o)?"col-sm-6 col-6":""}createDataFilterFormGroup(){return new _.cw({month:new _.NI(this.month$.id,[_.kI.required]),year:new _.NI(this.year$,[_.kI.required]),sources:new _.NI(""),districts:new _.NI("",this.roles.isChws()?[]:[_.kI.required]),sites:new _.NI("",this.roles.isChws()?[]:[_.kI.required]),chws:new _.NI(""),cmm_start_year_month:new _.NI(this.yearCmmMonthStartList$?.[0]?.id,[_.kI.required]),cmm_mutipliation:new _.NI(1,[_.kI.required])})}yearCmmMonthStart(){const e=parseInt(this.getValue("action_year")?.value??this.year$),n=this.getValue("action_month")?.value??this.month$.id,a=e+1,o=e-1,s=[],d=n>="07"&&n<="12";n>="01"&&n<="06"?s.push({id:`juillet_${o}_juin_${e}`,name:`Jul. ${o.toString().slice(-2)} - Jui. ${e.toString().slice(-2)}`}):d&&s.push({id:`juillet_${e}_juin_${a}`,name:`Jul. ${e.toString().slice(-2)} - Jui. ${a.toString().slice(-2)}`}),s.push({id:`janvier_decembre_${e}`,name:`Jan. - D\xe9c. ${e.toString().slice(-2)}`}),this.yearCmmMonthStartList$=s}editCmmClick(e,n=!1){this.editCmm[e]=1==n?this.editCmm[e]="":"edit"==this.editCmm[e]?"":"edit"}editQtyValidatedClick(e,n=!1){this.editQtyValidated[e]=1==n?this.editQtyValidated[e]="":"edit"==this.editQtyValidated[e]?"":"edit"}editQtyDeliveredClick(e,n=!1){this.editQtyDelivered[e]=1==n?this.editQtyDelivered[e]="":"edit"==this.editQtyDelivered[e]?"":"edit"}editObservationsClick(e,n=!1){this.editObservations[e]=1==n?this.editObservations[e]="":"edit"==this.editObservations[e]?"":"edit"}ngOnInit(){this.currentUser=this.auth.currentUser(),this.chwOU=this.auth.ChwLogged(),this.roles.isChws()&&(null==this.chwOU||!(0,l.Nf)(this.chwOU))&&this.router.navigate(["chws/select_orgunit"]),this.isLoading=!1,this.initDate=(0,Q.vW)(),this.Months$=(0,l.e7)(),this.Years$=(0,l.tR)(),this.year$=(0,l.VK)(this.initDate.end_date),this.month$=(0,l.dK)(this.initDate.end_date),this.chwsDrugDataForm=this.createDataFilterFormGroup(),this.roles.isChws()?this.initDataFilted():this.initAllData()}saveOrUpdate(e,n){if(e.preventDefault(),this.FinalChwsOutputData$.length>0){this.isUpdateLoading[n]="true";const s=this.FinalChwsOutputData$[0];var a=0;const c=this.objectKeys(s.data).length;for(let d=0;d<c;d++){const u=this.getKey(this.toChwsDrugData(this.sortedArray(s.data),d).key),h=this.getLabel(this.toChwsDrugData(this.sortedArray(s.data),d).key),g=this.getDataInfo(n);if(g&&g.district&&g.site&&g.chw){const m=this.getValue(`year_chw_cmm_${n}_${u}`),C=this.getValue(`quantity_validated_${n}_${u}`),f=this.getValue(`delivered_quantity_${n}_${u}`),y=this.getValue(`observations_${n}_${u}`);m?.index!=u&&C?.index!=u&&f?.index!=u&&y?.index!=u||this.sync.ihDrugUpdateDataPerChw({year:this.chwsDrugDataForm.value.year,month:this.chwsDrugDataForm.value.month,district:g.district,site:g.site,chw:g.chw,drug_index:u,drug_name:h,year_chw_cmm:m?.value,quantity_validated:C?.value,delivered_quantity:f?.value,observations:y?.value,cmm_start_year_month:this.chwsDrugDataForm.value.cmm_start_year_month,cmm_mutipliation:this.chwsDrugDataForm.value.cmm_mutipliation}).subscribe(Z=>{if(a+=1,200==Z.status){if(a==c-1&&Z.data){const U=this.FinalChwsOutputData$.map(w=>w.chwId==g.chw?Z.data[0]:w);this.FinalChwsOutputData$=U.sort((w,D)=>w.chw.external_id.localeCompare(D.chw.external_id)),this.editCmmClick(n,!0),this.editQtyValidatedClick(n,!0),this.editQtyDeliveredClick(n,!0),this.editObservationsClick(n,!0)}}else this.drugUpdateErrorMsg+=Z.data.toString();a==c-1&&(this.isUpdateLoading[n]="false")},Z=>{this.drugUpdateErrorMsg+=Z.toString(),this.isUpdateLoading[n]="false"})}}}}getValue(e){const n=document.getElementById(e);if(null!=n){const a=n.dataset.drugIndex;return{value:n.value,index:a?parseInt(a):void 0}}}getDataInfo(e){const n=document.getElementById(`data-info-${e}`);if(null!=n)return{district:n.dataset.district??"",site:n.dataset.site??"",chw:n.dataset.chw??""}}showHideMsg(e){this.dataDetail=e??""}BorrowingLendingShowHideMsg(e,n){this.dataDetail=(e??"")+(n??"")}convertQty(e){return 0==e||""==e||null==e||"0"==e||null==e?void 0:e}EcartColor(e){const n=this.convertQty(e.inventory_quantity)??0,a=this.convertQty(e.theoretical_quantity)??0;if(0!=n&&0!=a){const o=n-a,s=o/a*100,c=s<0?-1*s:s;return{value:`${o}`,ecart:`( ${c.toFixed(0)}% )`,color:c>5?"red":"green"}}return{value:"",ecart:"",color:""}}toChwsDrugData(e,n){const a=e[parseInt(n)];return{key:a[0],val:a[1]}}sortedArray(e){return Object.entries(e).sort((n,a)=>{const o=n[0].split("_"),s=a[0].split("_");return parseInt(o[o.length-1])-parseInt(s[s.length-1])})}objectKeys(e){return Object.keys(this.sortedArray(e))}getKey(e){const n=e.split("_");return parseInt(n[n.length-1])}getLabel(e){return e.split("_").slice(0,-1).join(" ")}csv(e){table2csv("data2csv",",",e)}excel(e){table2excel("data2excel",e)}pdf(e){table2pdf("data2pdf","l",e)}json(e){table2json("data2json",e)}print(e){printTable("data2print",e)}initAllData(){var e=this;return(0,x.Z)(function*(){e.isLoading=!0;const n=e.ParamsToFilter();e.initMsg="Chargement des Districts ...",e.sync.getDistrictsList(n).subscribe(function(){var a=(0,x.Z)(function*(o){200==o.status&&(e.Districts$=o.data.sort((s,c)=>s.name.localeCompare(c.name))),e.initMsg="Chargement des Sites ...",e.sync.getSitesList(n).subscribe(function(){var s=(0,x.Z)(function*(c){200==c.status&&(e.Sites$=c.data.sort((d,u)=>d.name.localeCompare(u.name))),e.genarateSites(),e.initMsg="Chargement des ASC ...",e.sync.getChwsList(n).subscribe(function(){var d=(0,x.Z)(function*(u){200==u.status&&(e.Chws$=u.data.sort((h,g)=>h.name.localeCompare(g.name))),e.genarateChws(),e.isLoading=!1});return function(u){return d.apply(this,arguments)}}(),d=>{e.isLoading=!1,console.log(d.error)})});return function(c){return s.apply(this,arguments)}}(),s=>{e.isLoading=!1,console.log(s.error)})});return function(o){return a.apply(this,arguments)}}(),a=>{e.isLoading=!1,console.log(a.error)})})()}genarateSites(){this.site$=[],this.chw$=[];const e=(0,l.pb)(this.chwsDrugDataForm.value.districts);if(this.chwsDrugDataForm.value.sites=[],this.chwsDrugDataForm.value.chws=[],(0,l.Nf)(e))for(let n=0;n<this.Sites$.length;n++){const a=this.Sites$[n];(0,l.Nf)(a)&&e.includes(a.district.id)&&this.site$.push(a)}else this.site$=[]}genarateChws(){const e=(0,l.pb)(this.chwsDrugDataForm.value.sites);if(this.chw$=[],this.chwsDrugDataForm.value.chws=[],(0,l.Nf)(e))for(let n=0;n<this.Chws$.length;n++){const a=this.Chws$[n];(0,l.Nf)(a)&&e.includes(a.site.id)&&this.chw$.push(a)}else this.chw$=[]}ParamsToFilter(){const e=this.chwsDrugDataForm.value.month,n=this.chwsDrugDataForm.value.year,a=this.chwsDrugDataForm.value.cmm_start_year_month,o=this.chwsDrugDataForm.value.cmm_mutipliation;var s=[],c=[],d=[];return this.roles.isChws()?null!=this.chwOU&&(0,l.Nf)(this.chwOU)&&(s=(0,l.pb)(this.chwOU.site.district.id),c=(0,l.pb)(this.chwOU.site.id),d=(0,l.pb)(this.chwOU.id),this.chw$=[this.chwOU]):(s=(0,l.pb)(this.chwsDrugDataForm.value.districts),c=(0,l.pb)(this.chwsDrugDataForm.value.sites),d=(0,l.pb)(this.chwsDrugDataForm.value.chws)),{year:parseInt(n),month:e,districts:s,sites:c,chws:d,cmm_start_year_month:a,cmm_mutipliation:o}}sort(e){return sortTable(e)}initDataFilted(e){this.isLoading=!0;const n=e??this.ParamsToFilter();this.defaultParams?.year!=n.year||this.defaultParams?.month!=n.month||this.defaultParams?.districts!=n.districts||this.defaultParams?.sites!=n.sites||this.defaultParams?.chws!=n.chws?this.sync.ihDrugDataPerChw(n).subscribe(a=>{this.response$=a,this.startTraitement(n)},a=>{this.isLoading=!1,this.ChwsDataFromDbError=a.toString()}):this.startTraitement(n)}startTraitement(e){this.isLoading=!0;const n=e??this.ParamsToFilter();200==this.response$.status?(this.FinalChwsOutputData$=this.response$.data.sort((o,s)=>o.chw.external_id.localeCompare(s.chw.external_id)),this.defaultParams=n,this.data_no_data_found=this.FinalChwsOutputData$.length<=0):(this.data_error_messages=this.response$.data.toString(),this.data_no_data_found=!0),this.isLoading=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(M.e),t.Y36(A._),t.Y36(T.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-drug-per-chw"]],decls:38,vars:13,consts:[[1,"content-header"],[1,"container-fluid"],[1,"card","card-info"],[1,"title",2,"text-align","center","color","blue"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],[1,"card-header"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-2","col-6"],[1,"form-group"],["class","form-control","formControlName","month",4,"ngIf"],["class","form-control","formControlName","year",4,"ngIf"],["class","col-sm-2 col-6",4,"ngIf"],["class","col-sm-3 col-6",4,"ngIf"],[2,"color","white"],["type","submit",1,"btn","btn-primary","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"content"],[1,"col-sm-5"],[4,"ngIf"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],["formControlName","month",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","year",1,"form-control"],["class","form-control","formControlName","districts",3,"change",4,"ngIf"],["formControlName","districts",1,"form-control",3,"change"],["formControlName","sites",1,"form-control",3,"change"],["value",""],[1,"col-sm-3","col-6"],["formControlName","chws",1,"form-control"],["formControlName","cmm_start_year_month",1,"form-control",2,"font-size","18px"],["formControlName","cmm_mutipliation",1,"form-control",2,"font-size","18px"],["value","1"],["value","2"],["value","3"],["value","4"],[1,"card-body"],[4,"ngFor","ngForOf"],[3,"id"],["novalidate","",3,"submit"],[1,"card"],[1,"card-title"],[1,"chw-info",2,"color","blue","font-size","20px"],["class","submit","type","submit","class","submit-btn btn btn-warning",3,"disabled",4,"ngIf"],[2,"overflow-x","scroll!important"],[1,"table","table-sm","table-striped",2,"margin","auto",3,"id"],[1,"bg-info","head-elem"],["rowspan","2"],[2,"color","green"],[3,"class","click",4,"ngIf"],["colspan","9"],[3,"click"],["type","submit",1,"submit-btn","btn","btn-warning",3,"disabled"],["style","margin-right: 20px!important;","class","fas fa-1x fa-sync-alt fa-spin",4,"ngIf"],[1,"fas","fa-1x","fa-sync-alt","fa-spin",2,"margin-right","20px!important"],[1,"ajust-cells"],["class","custom-input form-control","type","number",3,"disabled","id","value",4,"ngIf"],[1,"same-line"],["class","fas fa-eye",3,"click",4,"ngIf"],["class","custom-textarea form-control",3,"disabled","id","value",4,"ngIf"],[3,"ngStyle"],["type","number",1,"custom-input","form-control",3,"disabled","id","value"],[1,"fas","fa-eye",3,"click"],[1,"custom-textarea","form-control",3,"disabled","id","value"]],template:function(e,n){1&e&&(t.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4,"Situation M\xe9dicament Des ASC"),t.qZA(),t.TgZ(5,"div",4),t.YNc(6,V,4,1,"div",5),t.TgZ(7,"div",6)(8,"form",7),t.NdJ("ngSubmit",function(){return n.initDataFilted()}),t.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"label"),t._uU(13,"Mois"),t.qZA(),t.YNc(14,B,2,1,"select",11),t.qZA()(),t.TgZ(15,"div",9)(16,"div",10)(17,"label"),t._uU(18,"Ann\xe9e"),t.qZA(),t.YNc(19,X,2,1,"select",12),t.qZA()(),t.YNc(20,et,5,1,"div",13),t.YNc(21,it,7,1,"div",13),t.YNc(22,ot,7,1,"div",14),t.YNc(23,st,6,1,"div",13),t.YNc(24,_t,13,0,"div",13),t.TgZ(25,"div",9)(26,"div",10)(27,"label",15),t._uU(28,"."),t.qZA(),t.TgZ(29,"button",16),t._uU(30," Charger les Donnees "),t._UZ(31,"span",17),t.qZA()()()()()()()(),t.TgZ(32,"div",18)(33,"div",1)(34,"div",19),t.YNc(35,ct,4,1,"h2",20),t.YNc(36,dt,4,0,"h2",20),t.qZA(),t.YNc(37,Jt,2,1,"div",20),t.qZA()()()()),2&e&&(t.xp6(6),t.Q6J("ngIf",n.isLoading),t.xp6(2),t.Q6J("formGroup",n.chwsDrugDataForm),t.xp6(6),t.Q6J("ngIf",n.Months$.length>0),t.xp6(5),t.Q6J("ngIf",n.Years$.length>0),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(5),t.Q6J("disabled",!n.chwsDrugDataForm.valid),t.xp6(6),t.Q6J("ngIf",""!=n.data_error_messages),t.xp6(1),t.Q6J("ngIf",1==n.data_no_data_found),t.xp6(1),t.Q6J("ngIf",""==n.data_error_messages&&n.FinalChwsOutputData$.length>0))},dependencies:[v.sg,v.O5,v.PC,_._Y,_.YN,_.Kr,_.EJ,_.JJ,_.JL,_.sg,_.u],styles:[".fa-times[_ngcontent-%COMP%]{color:red;font-size:25px}.fa-edit[_ngcontent-%COMP%]{color:orange;font-size:25px}.custom-input[_ngcontent-%COMP%]{width:90px!important;height:23px!important;margin:-2.5px 0 0!important;padding:1px!important}.custom-textarea[_ngcontent-%COMP%]{width:200px!important;height:23px!important;margin:-2.5px 0 0!important;padding:1px!important}.same-line[_ngcontent-%COMP%]{white-space:nowrap}.same-line[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .same-line[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .same-line[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:inline-block;vertical-align:top}.same-line[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;margin-left:2.5px}.same-line[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:130px!important;height:15px!important;overflow:hidden}.ajust-cells[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:265px!important}.ajust-cells[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:90px!important;height:0px!important}.submit-btn[_ngcontent-%COMP%]{min-width:200px!important;margin-right:20px;float:right}.card-title[_ngcontent-%COMP%]{width:100%!important}.chw-info[_ngcontent-%COMP%]{float:left!important}ul[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0;overflow:hidden;float:right!important}li[_ngcontent-%COMP%]{background-color:#333;float:right}li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;color:#fff;text-align:center;padding:2px 5px;text-decoration:none;font-size:12px;cursor:pointer}li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{background-color:#111}"]}),i})();var St=p(6938);function kt(i,r){if(1&i&&(t.TgZ(0,"div",35),t._UZ(1,"i",36),t.TgZ(2,"div",37),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.initMsg," ")}}function Et(i,r){if(1&i&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.labelFR," ")}}function Yt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"select",38),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.yearCmmMonthStart())}),t.YNc(1,Et,2,2,"option",39),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.Months$)}}function Lt(i,r){if(1&i&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e),t.xp6(1),t.hij(" ",e," ")}}function jt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"select",41),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.yearCmmMonthStart())}),t.YNc(1,Lt,2,2,"option",39),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.Years$)}}function Gt(i,r){if(1&i&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function Kt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"select",43),t.NdJ("change",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.genarateSites())}),t.YNc(1,Gt,2,2,"option",39),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.Districts$)}}function Ht(i,r){if(1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"District"),t.qZA(),t.YNc(4,Kt,2,1,"select",42),t.qZA()()),2&i){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.Districts$.length>0)}}function Vt(i,r){if(1&i&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function zt(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"Site"),t.qZA(),t.TgZ(4,"select",44),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.genarateChws())}),t._UZ(5,"option",45),t.YNc(6,Vt,2,2,"option",39),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.site$)}}function Bt(i,r){if(1&i&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function Rt(i,r){if(1&i&&(t.TgZ(0,"div",46)(1,"div",10)(2,"label"),t._uU(3,"ASC"),t.qZA(),t.TgZ(4,"select",47),t._UZ(5,"option",45),t.YNc(6,Bt,2,2,"option",39),t.qZA()()()),2&i){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.chw$)}}function Xt(i,r){if(1&i&&(t.TgZ(0,"option",40),t._uU(1),t.qZA()),2&i){const e=r.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function Wt(i,r){if(1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"Annee CMM"),t.qZA(),t.TgZ(4,"select",48),t.YNc(5,Xt,2,2,"option",39),t.qZA()()()),2&i){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.yearCmmMonthStartList$)}}function te(i,r){1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"label"),t._uU(3,"Calcul CMM"),t.qZA(),t.TgZ(4,"select",49)(5,"option",50),t._uU(6,"CMM * 1"),t.qZA(),t.TgZ(7,"option",51),t._uU(8,"CMM * 2"),t.qZA(),t.TgZ(9,"option",52),t._uU(10,"CMM * 3"),t.qZA(),t.TgZ(11,"option",53),t._uU(12,"CMM * 4"),t.qZA()()()())}function ee(i,r){if(1&i&&(t.TgZ(0,"h2")(1,"div",2)(2,"div",54),t._uU(3),t.qZA()()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.data_error_messages," ")}}function ne(i,r){1&i&&(t.TgZ(0,"h2")(1,"div",2)(2,"div",54),t._uU(3," Pas de donn\xe9es trouv\xe9e avec les paramettres renseign\xe9s ! "),t.qZA()()())}function ie(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"ul")(1,"li")(2,"span",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.excel("export_table"))}),t._uU(3,"Excel"),t.qZA()(),t.TgZ(4,"li")(5,"span",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.csv("export_table"))}),t._uU(6,"CSV"),t.qZA()(),t.TgZ(7,"li")(8,"span",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.json("export_table"))}),t._uU(9,"JSON"),t.qZA()(),t.TgZ(10,"li")(11,"span",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.pdf("export_table"))}),t._uU(12,"PDF"),t.qZA()(),t.TgZ(13,"li")(14,"span",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.print("export_table"))}),t._uU(15,"PRINT"),t.qZA()()()}}function ae(i,r){1&i&&t._UZ(0,"i",78)}function oe(i,r){if(1&i&&(t.TgZ(0,"button",76),t.YNc(1,ae,1,0,"i",77),t._uU(2),t.qZA()),2&i){const e=t.oxw(3);t.Q6J("disabled",1==e.isUpdateLoading),t.xp6(1),t.Q6J("ngIf",1==e.isUpdateLoading),t.xp6(1),t.hij(" ",1==e.isUpdateLoading?"Sauvegarde en cours ...":"Mettre \xe0 jour"," ")}}function re(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.editCmmClick())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Gre("fas ","edit"==e.editCmm?"fa-times":"fa-edit","")}}function se(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.editQtyValidatedClick())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Gre("fas ","edit"==e.editQtyValidated?"fa-times":"fa-edit","")}}function _e(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.editQtyDeliveredClick())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Gre("fas ","edit"==e.editQtyDelivered?"fa-times":"fa-edit","")}}function ce(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",75),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.editObservationsClick())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Gre("fas ","edit"==e.editObservations?"fa-times":"fa-edit","")}}const de=function(i){return{color:i,"font-weight":"bold"}};function le(i,r){if(1&i&&(t.TgZ(0,"p")(1,"span",85),t._uU(2),t.qZA()()),2&i){const e=r.ngIf;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,de,e.color)),t.xp6(1),t.Oqu(e.value)}}const ue=function(i){return{color:i}};function ge(i,r){if(1&i&&(t.TgZ(0,"p")(1,"span",85),t._uU(2),t.qZA()()),2&i){const e=r.ngIf;t.xp6(1),t.Q6J("ngStyle",t.VKq(2,ue,e.color)),t.xp6(1),t.Oqu(e.ecart)}}function pe(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).ngIf,n=t.oxw(6);t.xp6(1),t.Oqu(n.convertQty(e.year_chw_cmm))}}function me(i,r){if(1&i&&t._UZ(0,"input",86),2&i){const e=t.oxw(2).ngIf,n=t.oxw().ngIf,a=t.oxw(5);t.MGl("id","year_chw_cmm_",n,""),t.s9C("value",e.year_chw_cmm),t.Q6J("disabled",1==a.isUpdateLoading),t.uIk("data-drug-index",n)}}function he(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).ngIf,n=t.oxw(6);t.xp6(1),t.hij(" ",n.convertQty(e.quantity_validated)," ")}}function fe(i,r){if(1&i&&t._UZ(0,"input",86),2&i){const e=t.oxw(2).ngIf,n=t.oxw().ngIf,a=t.oxw(5);t.MGl("id","quantity_validated_",n,""),t.s9C("value",e.quantity_validated),t.Q6J("disabled",1==a.isUpdateLoading),t.uIk("data-drug-index",n)}}function ve(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).ngIf,n=t.oxw(6);t.xp6(1),t.hij(" ",n.convertQty(e.delivered_quantity)," ")}}function xe(i,r){if(1&i&&t._UZ(0,"input",86),2&i){const e=t.oxw(2).ngIf,n=t.oxw().ngIf,a=t.oxw(5);t.MGl("id","delivered_quantity_",n,""),t.s9C("value",e.delivered_quantity),t.Q6J("disabled",1==a.isUpdateLoading),t.uIk("data-drug-index",n)}}function Ze(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",87),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().ngIf,o=t.oxw().ngIf,s=t.oxw(6);return t.KtG(s.BorrowingLendingShowHideMsg(a,o.borrowing_chws_code,o.lending_chws_code))}),t.qZA()}}function Ce(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",87),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2).ngIf,o=t.oxw(6);return t.KtG(o.showHideMsg(a.comments))}),t.qZA()}}function we(i,r){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).ngIf;t.xp6(1),t.hij(" ",e.observations," ")}}function be(i,r){if(1&i&&t._UZ(0,"input",88),2&i){const e=t.oxw(2).ngIf,n=t.oxw().ngIf,a=t.oxw(5);t.MGl("id","observations_",n,""),t.s9C("value",e.observations),t.Q6J("disabled",1==a.isUpdateLoading),t.uIk("data-drug-index",n)}}function Te(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"i",87),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2).ngIf,o=t.oxw(6);return t.KtG(o.showHideMsg(a.observations))}),t.qZA()}}function ye(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"tr")(2,"td")(3,"b"),t._uU(4),t.qZA()(),t.TgZ(5,"td",79)(6,"label")(7,"b"),t._uU(8),t.qZA()()(),t.TgZ(9,"td",79)(10,"p"),t._uU(11),t.qZA()(),t.TgZ(12,"td",79)(13,"p"),t._uU(14),t.qZA()(),t.TgZ(15,"td",79)(16,"p"),t._uU(17),t.qZA()(),t.TgZ(18,"td",79)(19,"p"),t._uU(20),t.qZA()(),t.TgZ(21,"td",79)(22,"p"),t._uU(23),t.qZA()(),t.TgZ(24,"td",79)(25,"p"),t._uU(26),t.qZA()(),t.TgZ(27,"td",79),t.YNc(28,le,3,4,"p",20),t.qZA(),t.TgZ(29,"td",79),t.YNc(30,ge,3,4,"p",20),t.qZA(),t.TgZ(31,"td",79)(32,"p"),t.YNc(33,pe,2,1,"span",20),t.YNc(34,me,1,4,"input",80),t.qZA()(),t.TgZ(35,"td",79)(36,"p"),t._uU(37),t.qZA()(),t.TgZ(38,"td",79)(39,"p"),t._uU(40),t.qZA()(),t.TgZ(41,"td",79)(42,"p"),t.YNc(43,he,2,1,"span",20),t.YNc(44,fe,1,4,"input",80),t.qZA()(),t.TgZ(45,"td",79)(46,"p"),t.YNc(47,ve,2,1,"span",20),t.YNc(48,xe,1,4,"input",80),t.qZA()(),t.TgZ(49,"td",79)(50,"p"),t._uU(51),t.qZA()(),t.TgZ(52,"td",79)(53,"p",81),t._uU(54),t.qZA()(),t.TgZ(55,"td",79)(56,"p",81),t._uU(57),t.qZA()(),t.TgZ(58,"td",82)(59,"p"),t._uU(60),t.qZA(),t.YNc(61,Ze,1,0,"i",83),t.qZA(),t.TgZ(62,"td",79)(63,"p",81),t._uU(64),t.qZA()(),t.TgZ(65,"td",79)(66,"p",81),t._uU(67),t.qZA()(),t.TgZ(68,"td",79)(69,"p",81),t._uU(70),t.qZA()(),t.TgZ(71,"td",79)(72,"p",81),t._uU(73),t.qZA()(),t.TgZ(74,"td",79)(75,"p",81),t._uU(76),t.qZA()(),t.TgZ(77,"td",82)(78,"p"),t._uU(79),t.qZA(),t.YNc(80,Ce,1,0,"i",83),t.qZA(),t.TgZ(81,"td",82),t.YNc(82,we,2,1,"span",20),t.YNc(83,be,1,4,"input",84),t.YNc(84,Te,1,0,"i",83),t.qZA()(),t.BQk()),2&i){const e=r.ngIf,n=t.oxw().ngIf,a=t.oxw().ngIf,o=t.oxw(5);let s,c;t.xp6(4),t.Oqu(a),t.xp6(4),t.Oqu(e),t.xp6(3),t.Oqu(o.convertQty(n.month_quantity_beginning)),t.xp6(3),t.Oqu(o.convertQty(n.month_quantity_received)),t.xp6(3),t.Oqu(o.convertQty(n.month_total_quantity)),t.xp6(3),t.Oqu(o.convertQty(n.month_consumption)),t.xp6(3),t.Oqu(o.convertQty(n.theoretical_quantity)),t.xp6(3),t.Oqu(o.convertQty(n.inventory_quantity)),t.xp6(2),t.Q6J("ngIf",o.EcartColor(n)),t.xp6(2),t.Q6J("ngIf",o.EcartColor(n)),t.xp6(3),t.Q6J("ngIf","edit"!=o.editCmm),t.xp6(1),t.Q6J("ngIf",o.roles.canUpdateChwsDrug()&&"edit"==o.editCmm),t.xp6(3),t.Oqu(o.convertQty(n.theoretical_quantity_to_order)),t.xp6(3),t.Oqu(o.convertQty(n.quantity_to_order)),t.xp6(3),t.Q6J("ngIf","edit"!=o.editQtyValidated),t.xp6(1),t.Q6J("ngIf",o.roles.canUpdateChwsDrug()&&"edit"==o.editQtyValidated),t.xp6(3),t.Q6J("ngIf","edit"!=o.editQtyDelivered),t.xp6(1),t.Q6J("ngIf",o.roles.canUpdateChwsDrug()&&"edit"==o.editQtyDelivered),t.xp6(3),t.Oqu(n.satisfaction_rate),t.xp6(3),t.Oqu(o.convertQty(n.borrowing_quantity)),t.xp6(3),t.Oqu(o.convertQty(n.lending_quantity)),t.xp6(3),t.AsE("",o.cancelArobase(n.borrowing_chws_code)," ",o.cancelArobase(n.lending_chws_code),""),t.xp6(1),t.Q6J("ngIf",""!=(null!==(s=n.lending_chws_code)&&void 0!==s?s:"")||""!=(null!==(s=n.borrowing_chws_code)&&void 0!==s?s:"")),t.xp6(3),t.Oqu(o.convertQty(n.quantity_loss)),t.xp6(3),t.Oqu(o.convertQty(n.quantity_damaged)),t.xp6(3),t.Oqu(o.convertQty(n.quantity_broken)),t.xp6(3),t.Oqu(o.convertQty(n.quantity_expired)),t.xp6(3),t.Oqu(o.convertQty(n.other_quantity)),t.xp6(3),t.Oqu(n.comments),t.xp6(1),t.Q6J("ngIf",""!=(null!==(c=n.comments)&&void 0!==c?c:"")),t.xp6(2),t.Q6J("ngIf","edit"!=o.editObservations),t.xp6(1),t.Q6J("ngIf",o.roles.canUpdateChwsDrug()&&"edit"==o.editObservations),t.xp6(1),t.Q6J("ngIf",""!=n.observations)}}function Ue(i,r){if(1&i&&(t.ynx(0),t.YNc(1,ye,85,34,"ng-container",20),t.BQk()),2&i){const e=t.oxw(2).ngIf,n=t.oxw(4);t.xp6(1),t.Q6J("ngIf",n.getLabel(e.key))}}function De(i,r){if(1&i&&(t.ynx(0),t.YNc(1,Ue,2,1,"ng-container",20),t.BQk()),2&i){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",e.val)}}function qe(i,r){if(1&i&&(t.ynx(0),t.YNc(1,De,2,1,"ng-container",20),t.BQk()),2&i){const e=r.ngIf,n=t.oxw(4);t.xp6(1),t.Q6J("ngIf",n.getKey(e.key))}}function Me(i,r){if(1&i&&(t.ynx(0),t.YNc(1,qe,2,1,"ng-container",20),t.BQk()),2&i){const e=r.$implicit,n=t.oxw().ngIf,a=t.oxw(2);t.xp6(1),t.Q6J("ngIf",a.toChwsDrugData(a.sortedArray(n.drugData),e))}}function Ae(i,r){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"form",55),t.NdJ("submit",function(a){t.CHM(e);const o=t.oxw(2);return t.KtG(o.saveOrUpdate(a))}),t.TgZ(2,"div",56)(3,"div",6)(4,"div",57),t._UZ(5,"p",58),t.ALo(6,"safeHtml"),t.YNc(7,ie,16,0,"ul",20),t.YNc(8,oe,3,3,"button",59),t.qZA()(),t.TgZ(9,"div",60)(10,"table",61)(11,"thead")(12,"tr",62)(13,"th",63),t._uU(14,"Id"),t.qZA(),t.TgZ(15,"th",63)(16,"button",64),t.NdJ("click",function(){return!0}),t._UZ(17,"i",65),t._uU(18," Patologies "),t.qZA(),t._UZ(19,"br")(20,"br"),t._uU(21," M E G "),t.qZA(),t.TgZ(22,"th",63),t._UZ(23,"div",66),t._uU(24," Quantit\xe9 d\xe9but du mois "),t._UZ(25,"br")(26,"br"),t._uU(27," (A) "),t.qZA(),t.TgZ(28,"th",63),t._UZ(29,"div",66),t._uU(30," Quantit\xe9 re\xe7ue au cours du mois "),t._UZ(31,"br")(32,"br"),t._uU(33," (B) "),t.qZA(),t.TgZ(34,"th",63),t._UZ(35,"div",66),t._uU(36," Quantit\xe9 totale du mois "),t._UZ(37,"br")(38,"br"),t._uU(39," (C=A+B) "),t.qZA(),t.TgZ(40,"th",63),t._UZ(41,"div",66),t._uU(42," Consommation mensuelle du mois "),t._UZ(43,"br")(44,"br"),t._uU(45," (D) "),t.qZA(),t.TgZ(46,"th",63),t._UZ(47,"div",66),t._uU(48," Quantit\xe9 th\xe9orique disponible \xe0 l'inventaire "),t._UZ(49,"br"),t._uU(50," (E=C-D) "),t.qZA(),t.TgZ(51,"th",63),t._UZ(52,"div",66),t._uU(53," Quantit\xe9 compt\xe9e \xe0 l'inventaire "),t._UZ(54,"br")(55,"br"),t._uU(56," (F) "),t.qZA(),t.TgZ(57,"th",67),t._uU(58," Ecart d'inventaire "),t._UZ(59,"br"),t._uU(60," (J=F-E) "),t.qZA(),t.TgZ(61,"th",63),t._UZ(62,"div",66),t._uU(63," CMM de l'ann\xe9e"),t._UZ(64,"br"),t._uU(65,"N-1 "),t._UZ(66,"br")(67,"span",68)(68,"br"),t._uU(69," (G) \xa0\xa0\xa0 "),t.YNc(70,re,1,3,"i",69),t.qZA(),t.TgZ(71,"th",63),t._UZ(72,"div",66),t._uU(73," Quantit\xe9 th\xe9orique \xe0 commander "),t._UZ(74,"br")(75,"br"),t._uU(76),t.qZA(),t.TgZ(77,"th",63),t._UZ(78,"div",66),t._uU(79," Quantit\xe9s \xe0 commander "),t._UZ(80,"br")(81,"br"),t.TgZ(82,"small")(83,"small"),t._uU(84,"(Expression besoins ASC)"),t.qZA()()(),t.TgZ(85,"th",63),t._UZ(86,"div",66),t._uU(87," Quantit\xe9 valid\xe9e "),t._UZ(88,"br")(89,"br")(90,"br"),t._uU(91," \xa0\xa0\xa0 "),t.YNc(92,se,1,3,"i",69),t.qZA(),t.TgZ(93,"th",63),t._UZ(94,"div",66),t._uU(95," Quantit\xe9 livr\xe9e "),t._UZ(96,"br")(97,"br")(98,"br"),t._uU(99," \xa0\xa0\xa0 "),t.YNc(100,_e,1,3,"i",69),t.qZA(),t.TgZ(101,"th",63),t._UZ(102,"div",66),t._uU(103," Taux de satisfaction "),t._UZ(104,"br")(105,"br")(106,"br"),t.qZA(),t.TgZ(107,"th",70),t._uU(108," Observation de l'ASC "),t.qZA(),t.TgZ(109,"th",63),t._UZ(110,"div",66),t._uU(111," Observations (Pharmacie) \xa0\xa0\xa0 "),t.YNc(112,ce,1,3,"i",69),t.qZA()(),t.TgZ(113,"tr",71)(114,"th",72),t._uU(115,"Emprunt/Pr\xeat du mois"),t.qZA(),t.TgZ(116,"th",73),t._UZ(117,"div",66),t._uU(118," Perte du mois "),t._UZ(119,"br"),t.qZA(),t.TgZ(120,"th",73),t._UZ(121,"div",66),t._uU(122," Avari\xe9 du mois "),t._UZ(123,"br"),t.qZA(),t.TgZ(124,"th",73),t._UZ(125,"div",66),t._uU(126," Cass\xe9 du mois "),t._UZ(127,"br"),t.qZA(),t.TgZ(128,"th",73),t._UZ(129,"div",66),t._uU(130," P\xe9rim\xe9 du mois "),t._UZ(131,"br"),t.qZA(),t.TgZ(132,"th",73),t._UZ(133,"div",66),t._uU(134," Autres sortie du mois "),t._UZ(135,"br"),t.qZA(),t.TgZ(136,"th",73),t._UZ(137,"div",66),t._uU(138," Commentaires ASC "),t._UZ(139,"br"),t.qZA()(),t.TgZ(140,"tr",71)(141,"th"),t._UZ(142,"div",66),t._uU(143,"Ecart en valeur "),t.qZA(),t.TgZ(144,"th"),t._uU(145,"Ecart en %"),t.qZA(),t.TgZ(146,"th"),t._UZ(147,"div",66),t._uU(148," Quantit\xe9 Emprunt du mois "),t._UZ(149,"br"),t.qZA(),t.TgZ(150,"th"),t._UZ(151,"div",66),t._uU(152," Quantit\xe9 Pr\xeat du mois "),t._UZ(153,"br"),t.qZA(),t.TgZ(154,"th"),t._UZ(155,"div",66),t._uU(156," Emprunt/Pr\xeat"),t._UZ(157,"br"),t._uU(158,"Nom & Code ASC"),t._UZ(159,"br"),t.qZA()()(),t.TgZ(160,"tbody"),t.YNc(161,Me,2,1,"ng-container",74),t.qZA()()()()()()}if(2&i){const e=r.ngIf,n=t.oxw(2);t.xp6(5),t.Q6J("innerHTML",t.lcZ(6,10,n.GenerateHearder(e)),t.oJD),t.xp6(2),t.Q6J("ngIf",n.roles.canDownloadReports()&&"edit"!=n.editCmm&&"edit"!=n.editQtyValidated&&"edit"!=n.editQtyDelivered&&"edit"!=n.editObservations),t.xp6(1),t.Q6J("ngIf",n.roles.canUpdateChwsDrug()&&"edit"==n.editCmm||"edit"==n.editQtyValidated||"edit"==n.editQtyDelivered||"edit"==n.editObservations||1==n.isUpdateLoading),t.xp6(2),t.Q6J("id","export_table"),t.xp6(60),t.Q6J("ngIf",n.roles.canUpdateChwsDrug()&&n.IsOkToUpdate),t.xp6(6),t.hij(" H = ",n.chwsDrugDataForm.value.cmm_mutipliation," * (G-F) "),t.xp6(16),t.Q6J("ngIf",n.roles.canUpdateChwsDrug()&&n.IsOkToUpdate),t.xp6(8),t.Q6J("ngIf",n.roles.canUpdateChwsDrug()&&n.IsOkToUpdate),t.xp6(12),t.Q6J("ngIf",n.roles.canUpdateChwsDrug()&&n.IsOkToUpdate),t.xp6(49),t.Q6J("ngForOf",n.objectKeys(e.drugData))}}function Pe(i,r){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Ae,162,12,"div",20),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.OutputData$)}}function Ie(i,r){if(1&i&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA()()),2&i){const e=r.$implicit;t.xp6(2),t.Oqu(e.key),t.xp6(2),t.Oqu(e.value)}}function Oe(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"table",89)(2,"tr")(3,"th",90),t._uU(4),t.qZA()(),t.TgZ(5,"tr")(6,"th"),t._uU(7,"Date"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Nombre d'actions"),t.qZA()(),t.YNc(10,Ie,5,2,"tr",74),t.ALo(11,"keyvalue"),t.TgZ(12,"tr")(13,"td"),t._uU(14,"Total Consultation"),t.qZA(),t.TgZ(15,"td",91),t._uU(16),t.ALo(17,"keyvalue"),t.qZA()()(),t._UZ(18,"br")(19,"br"),t.BQk()),2&i){const e=r.$implicit,n=t.oxw(2);t.xp6(4),t.hij("",n.rewriteName(e.key)," (Soins)"),t.xp6(6),t.Q6J("ngForOf",t.lcZ(11,3,e.value)),t.xp6(6),t.Oqu(n.totalPatologie(t.lcZ(17,5,e.value)))}}function Qe(i,r){if(1&i&&(t.ynx(0),t.TgZ(1,"h1",68),t._uU(2,"Pcime"),t.qZA(),t._UZ(3,"br"),t.YNc(4,Oe,20,7,"ng-container",74),t.ALo(5,"keyvalue"),t.BQk()),2&i){const e=t.oxw();t.xp6(4),t.Q6J("ngForOf",t.lcZ(5,1,e.OutputData$.patologieData))}}const $e=[{path:"",redirectTo:"replacements",pathMatch:"full"},{path:"replacements",component:H,canActivate:[P.o],data:{href:"replacements",icon:"fa fa-user",label:"Remplacants",title:"Gestion ASC Remplacantes"}},{path:"drug-per-chw",component:Ft,canActivate:[P.o],data:{href:"drug_per_chw",icon:"fa fa-user",label:"drug_per_chw",title:"M\xe9dicament Par ASC"}},{path:"drug-per-selected",component:(()=>{class i{constructor(e,n,a){this.auth=e,this.sync=n,this.router=a,this.roles=new O.G(this.auth),this.data_error_messages="",this.data_no_data_found=!1,this.ChwsDataFromDbError="",this.dataDetail="",this.Districts$=[],this.Sites$=[],this.Chws$=[],this.Months$=[],this.Years$=[],this.chw$=[],this.site$=[],this.IsOkToUpdate=!1,this.drugUpdateErrorMsg="",this.isUpdateLoading=!1,this.editCmm="",this.editQtyValidated="",this.editQtyDelivered="",this.editObservations="",this.isNumber=o=>!isNaN(o),this.showClass=o=>this.isNumber(o)?"col-sm-6 col-6":""}createDataFilterFormGroup(){return new _.cw({month:new _.NI(this.month$.id,[_.kI.required]),year:new _.NI(this.year$,[_.kI.required]),sources:new _.NI(""),districts:new _.NI("",this.roles.isChws()?[]:[_.kI.required]),sites:new _.NI(""),chws:new _.NI(""),cmm_start_year_month:new _.NI(this.yearCmmMonthStartList$?.[0]?.id,[_.kI.required]),cmm_mutipliation:new _.NI(1,[_.kI.required])})}editCmmClick(e=!1){this.editCmm=1==e?this.editCmm="":"edit"==this.editCmm?"":"edit"}editQtyValidatedClick(e=!1){this.editQtyValidated=1==e?this.editQtyValidated="":"edit"==this.editQtyValidated?"":"edit"}editQtyDeliveredClick(e=!1){this.editQtyDelivered=1==e?this.editQtyDelivered="":"edit"==this.editQtyDelivered?"":"edit"}editObservationsClick(e=!1){this.editObservations=1==e?this.editObservations="":"edit"==this.editObservations?"":"edit"}GenerateHearder(e){const n=e.cible;try{return`${n.site.district.name} > ${n.site.name} > <strong>${n.name}</strong> (${n.external_id}) `}catch{try{return`${n.district.name} > <strong>${n.name}</strong> (${n.external_id}) `}catch{try{return`<strong>${n.name}</strong> (${n.id}) `}catch{}}}return""}yearCmmMonthStart(){const e=parseInt(this.getValue("action_year")?.value??this.year$),n=this.getValue("action_month")?.value??this.month$.id,a=e+1,o=e-1,s=[],d=n>="07"&&n<="12";n>="01"&&n<="06"?s.push({id:`juillet_${o}_juin_${e}`,name:`Jul. ${o.toString().slice(-2)} - Jui. ${e.toString().slice(-2)}`}):d&&s.push({id:`juillet_${e}_juin_${a}`,name:`Jul. ${e.toString().slice(-2)} - Jui. ${a.toString().slice(-2)}`}),s.push({id:`janvier_decembre_${e}`,name:`Jan. - D\xe9c. ${e.toString().slice(-2)}`}),this.yearCmmMonthStartList$=s}IsOkToUpdateFields(){this.IsOkToUpdate=""!=(this.chwsDrugDataForm.value.districts??"")&&""!=(this.chwsDrugDataForm.value.sites??"")&&""!=(this.chwsDrugDataForm.value.chws??"")&&""!=(this.chwsDrugDataForm.value.year??"")&&""!=(this.chwsDrugDataForm.value.month??"")}ngOnInit(){this.currentUser=this.auth.currentUser(),this.chwOU=this.auth.ChwLogged(),this.roles.isChws()&&(null==this.chwOU||!(0,l.Nf)(this.chwOU))&&this.router.navigate(["chws/select_orgunit"]),this.isLoading=!1,this.initDate=(0,Q.vW)(),this.Months$=(0,l.e7)(),this.Years$=(0,l.tR)(),this.year$=(0,l.VK)(this.initDate.end_date),this.month$=(0,l.dK)(this.initDate.end_date),this.yearCmmMonthStart(),this.chwsDrugDataForm=this.createDataFilterFormGroup(),this.roles.isChws()?this.initDataFilted():this.initAllData()}saveOrUpdate(e){if(e.preventDefault(),this.isUpdateLoading=!0,this.OutputData$){const a=this.chwsDrugDataForm.value.year,o=this.chwsDrugDataForm.value.month,s=this.chwsDrugDataForm.value.districts,c=this.chwsDrugDataForm.value.sites,d=this.chwsDrugDataForm.value.chws,u=this.chwsDrugDataForm.value.cmm_start_year_month,h=this.chwsDrugDataForm.value.cmm_mutipliation;if(""!=(s??"")&&""!=(c??"")&&""!=(d??"")&&""!=(a??"")&&""!=(o??"")){const g=this.OutputData$;var n=0;const m=this.objectKeys(g.drugData).length;for(let C=0;C<m;C++){const f=this.getKey(this.toChwsDrugData(this.sortedArray(g.drugData),C).key),y=this.getLabel(this.toChwsDrugData(this.sortedArray(g.drugData),C).key),Z=this.getValue(`year_chw_cmm_${f}`),U=this.getValue(`quantity_validated_${f}`),w=this.getValue(`delivered_quantity_${f}`),D=this.getValue(`observations_${f}`);if(Z?.index==f||U?.index==f||w?.index==f||D?.index==f){const N={year:a,month:o,district:s,site:c,chw:d,drug_index:f,drug_name:y,year_chw_cmm:Z?.value,quantity_validated:U?.value,delivered_quantity:w?.value,observations:D?.value,cmm_start_year_month:u,cmm_mutipliation:h};this.sync.ihDrugUpdateYearCmmPerChw(N).subscribe(J=>{200==J.status?this.sync.ihDrugUpdateDataPerChw(N).subscribe(b=>{if(n+=1,200==b.status){if(n==m-1&&b.data){if(this.OutputData$.cibleId==d){const q=b.data;this.OutputData$={cibleId:q.chwId,cible:q.chw,drugData:q.drugData,patologieData:q.patologieData}}this.editCmmClick(!0),this.editQtyValidatedClick(!0),this.editQtyDeliveredClick(!0),this.editObservationsClick(!0)}}else this.drugUpdateErrorMsg+=b.data.toString();n==m-1&&(this.isUpdateLoading=!1)},b=>{this.drugUpdateErrorMsg+=b.toString(),this.isUpdateLoading=!1}):(this.drugUpdateErrorMsg+=J.data,this.isUpdateLoading=!1)})}}}else this.isUpdateLoading=!1}else this.isUpdateLoading=!1}getValue(e){const n=document.getElementById(e);if(null!=n){const a=n.dataset.drugIndex;return{value:n.value,index:a?parseInt(a):void 0}}}showHideMsg(e){this.dataDetail=e??""}cancelArobase(e){return`${e}`.split("@@@").join(" | ")}rewriteName(e){return`${e}`.split("_").join(" ")}totalPatologie(e){var n=0;for(let a=0;a<e.length;a++)n+=e[a].value;return n}BorrowingLendingShowHideMsg(e,n,a){var o=`<strong style="font-size:18px; color:blue;">${e}</strong><br><br>`,s="";const c='class="table table-sm" style="margin: auto;"',d='style="border: 1px dashed rgb(177, 177, 177);"',u='style="border: 1px dashed rgb(177, 177, 177);background: rgb(0, 0, 67); color: white;"';if(""!=(n??"")){o+='<strong style="color:green;">Emprunts de m\xe9dicaments</strong><br>',o+=`<table ${c}> <tr> <th ${u}>Date</th> <th ${u}>Quantit\xe9</th> <th ${u}>ASC</th> </tr>`;const h=n?.split("|||")??[];for(let g=0;g<h.length;g++){const m=h[g].split("@@@");o+=`<tr><td ${d}>${m[2]}</td><td ${d}>${m[1]}</td><td ${d}>${m[0]}</td></tr>`}o+="</table>",o+="<br><br>"}if(""!=(a??"")){o+='<strong style="color:green;">Pr\xeats de m\xe9dicaments</strong><br>',s+=`<table ${c}> <tr style="background-color:blue!important;"><th ${u}>Date</th><th ${u}>Quantit\xe9</th><th ${u}>ASC</th></tr>`;const h=a?.split("|||")??[];for(let g=0;g<h.length;g++){const m=h[g].split("@@@");s+=`<tr><td ${d}>${m[2]}</td><td ${d}>${m[1]}</td><td ${d}>${m[0]}</td></tr>`}s+="</table>",s+="<br>"}this.dataDetail=`${o}${s}`}convertQty(e){return 0==e||""==e||null==e||"0"==e||null==e?void 0:e}EcartColor(e){const n=this.convertQty(e.inventory_quantity)??0,a=this.convertQty(e.theoretical_quantity)??0;if(0!=n&&0!=a){const o=n-a,s=o/a*100,c=s<0?-1*s:s;return{value:`${o}`,ecart:c>100?"> 100%":`${c.toFixed(0)}%`,color:c>5?"red":"green"}}return{value:"",ecart:"",color:""}}toChwsDrugData(e,n){const a=e[parseInt(n)];return{key:a[0],val:a[1]}}sortedArray(e){return Object.entries(e).sort((n,a)=>{const o=n[0].split("_"),s=a[0].split("_");return parseInt(o[o.length-1])-parseInt(s[s.length-1])})}objectKeys(e){return Object.keys(this.sortedArray(e))}patologiesObjectKeys(e){return Object.keys(e)}getKey(e){const n=e.split("_");return parseInt(n[n.length-1])}getLabel(e){return e.split("_").slice(0,-1).join(" ")}csv(e){table2csv("data2csv",",",e)}excel(e){table2excel("data2excel",e)}pdf(e){table2pdf("data2pdf","l",e)}json(e){table2json("data2json",e)}print(e){printTable("data2print",e)}initAllData(){var e=this;return(0,x.Z)(function*(){e.isLoading=!0;const n=e.ParamsToFilter();e.initMsg="Chargement des Districts ...",e.sync.getDistrictsList(n).subscribe(function(){var a=(0,x.Z)(function*(o){200==o.status&&(e.Districts$=o.data.sort((s,c)=>s.name.localeCompare(c.name))),e.initMsg="Chargement des Sites ...",e.sync.getSitesList(n).subscribe(function(){var s=(0,x.Z)(function*(c){200==c.status&&(e.Sites$=c.data.sort((d,u)=>d.name.localeCompare(u.name))),e.genarateSites(),e.initMsg="Chargement des ASC ...",e.sync.getChwsList(n).subscribe(function(){var d=(0,x.Z)(function*(u){200==u.status&&(e.Chws$=u.data.sort((h,g)=>h.name.localeCompare(g.name))),e.genarateChws(),e.isLoading=!1});return function(u){return d.apply(this,arguments)}}(),d=>{e.isLoading=!1,console.log(d.error)})});return function(c){return s.apply(this,arguments)}}(),s=>{e.isLoading=!1,console.log(s.error)})});return function(o){return a.apply(this,arguments)}}(),a=>{e.isLoading=!1,console.log(a.error)})})()}genarateSites(){this.site$=[],this.chw$=[];const e=(0,l.pb)(this.chwsDrugDataForm.value.districts);if(this.chwsDrugDataForm.value.sites=[],this.chwsDrugDataForm.value.chws=[],(0,l.Nf)(e))for(let n=0;n<this.Sites$.length;n++){const a=this.Sites$[n];(0,l.Nf)(a)&&e.includes(a.district.id)&&this.site$.push(a)}else this.site$=[]}genarateChws(){const e=(0,l.pb)(this.chwsDrugDataForm.value.sites);if(this.chw$=[],this.chwsDrugDataForm.value.chws=[],(0,l.Nf)(e))for(let n=0;n<this.Chws$.length;n++){const a=this.Chws$[n];(0,l.Nf)(a)&&e.includes(a.site.id)&&this.chw$.push(a)}else this.chw$=[]}ParamsToFilter(){const e=this.chwsDrugDataForm.value.month,n=this.chwsDrugDataForm.value.year,a=this.chwsDrugDataForm.value.cmm_start_year_month,o=this.chwsDrugDataForm.value.cmm_mutipliation;var s=[],c=[],d=[];return this.roles.isChws()?null!=this.chwOU&&(0,l.Nf)(this.chwOU)&&(s=(0,l.pb)(this.chwOU.site.district.id),c=(0,l.pb)(this.chwOU.site.id),d=(0,l.pb)(this.chwOU.id),this.chw$=[this.chwOU]):(s=(0,l.pb)(this.chwsDrugDataForm.value.districts),c=(0,l.pb)(this.chwsDrugDataForm.value.sites),d=(0,l.pb)(this.chwsDrugDataForm.value.chws)),{year:parseInt(n),month:e,districts:s,sites:c,chws:d,cmm_start_year_month:a,cmm_mutipliation:o}}sort(e){return sortTable(e)}initDataFilted(e){this.isLoading=!0;const n=e??this.ParamsToFilter();this.defaultParams?.year!=n.year||this.defaultParams?.month!=n.month||this.defaultParams?.districts!=n.districts||this.defaultParams?.sites!=n.sites||this.defaultParams?.chws!=n.chws?this.sync.ihDrugDataPerSelected(n).subscribe(a=>{this.response$=a,this.startTraitement(n)},a=>{this.isLoading=!1,this.ChwsDataFromDbError=a.toString()}):this.startTraitement(n)}startTraitement(e){this.isLoading=!0,this.IsOkToUpdateFields();const n=e??this.ParamsToFilter();200==this.response$.status?(this.OutputData$=this.response$.data,this.defaultParams=n,this.data_no_data_found=null==(this.OutputData$??null)):(this.data_error_messages=this.response$.data.toString(),this.data_no_data_found=!0),this.isLoading=!1}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(M.e),t.Y36(A._),t.Y36(T.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-drug-per-chw"]],decls:70,vars:17,consts:[[1,"content-header"],[1,"container-fluid"],[1,"card","card-info"],[1,"title",2,"text-align","center","color","blue"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],[1,"card-header"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-2","col-6"],[1,"form-group"],["style","font-size: 18px;","id","action_month","class","form-control","formControlName","month",3,"change",4,"ngIf"],["style","font-size: 18px;","id","action_year","class","form-control","formControlName","year",3,"change",4,"ngIf"],["class","col-sm-2 col-6",4,"ngIf"],["class","col-sm-3 col-6",4,"ngIf"],[2,"color","white"],["type","submit",1,"btn","btn-primary","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"content"],[1,"col-sm-5"],[4,"ngIf"],["id","modal-detail",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content","bg-default"],[1,"modal-header"],[2,"font-size","20px"],["id","active-update-modal","data-toggle","modal","data-target","#modal-detail"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body",3,"innerHTML"],[1,"modal-footer","justify-content-between"],["id","close-update-modal","type","button","data-dismiss","modal",1,"btn","btn-default"],["id","modal-patologies",1,"modal","fade"],["id","active-update-modal","data-toggle","modal","data-target","#modal-patologies"],[1,"modal-body"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],["id","action_month","formControlName","month",1,"form-control",2,"font-size","18px",3,"change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["id","action_year","formControlName","year",1,"form-control",2,"font-size","18px",3,"change"],["style","font-size: 18px;","class","form-control","formControlName","districts",3,"change",4,"ngIf"],["formControlName","districts",1,"form-control",2,"font-size","18px",3,"change"],["formControlName","sites",1,"form-control",2,"font-size","18px",3,"change"],["value",""],[1,"col-sm-3","col-6"],["formControlName","chws",1,"form-control",2,"font-size","18px"],["formControlName","cmm_start_year_month",1,"form-control",2,"font-size","18px"],["formControlName","cmm_mutipliation",1,"form-control",2,"font-size","18px"],["value","1"],["value","2"],["value","3"],["value","4"],[1,"card-body"],["novalidate","",3,"submit"],[1,"card"],[1,"card-title"],[1,"chw-info",2,"color","blue","font-size","20px",3,"innerHTML"],["class","submit","type","submit","class","submit-btn btn btn-warning",3,"disabled",4,"ngIf"],[2,"overflow-x","scroll!important"],[1,"table","table-sm","table-striped",2,"margin","auto",3,"id"],[1,"bg-primary","head-elem"],["rowspan","3"],["type","button","data-toggle","modal","data-target","#modal-patologies",1,"btn","btn-info","form-control",2,"width","140px","height","55px","font-size","large",3,"click"],[1,"fas","fa-eye"],[1,"drug_thead"],["rowspan","2","colspan","2"],[2,"color","green"],[3,"class","click",4,"ngIf"],["colspan","9"],[1,"bg-info","head-elem"],["colspan","3"],["rowspan","2"],[4,"ngFor","ngForOf"],[3,"click"],["type","submit",1,"submit-btn","btn","btn-warning",3,"disabled"],["style","margin-right: 20px!important;","class","fas fa-1x fa-sync-alt fa-spin",4,"ngIf"],[1,"fas","fa-1x","fa-sync-alt","fa-spin",2,"margin-right","20px!important"],[1,"ajust-cells"],["class","custom-input form-control","type","number",3,"disabled","id","value",4,"ngIf"],[1,"out-data"],[1,"same-line"],["class","fas fa-eye","data-toggle","modal","data-target","#modal-detail",3,"click",4,"ngIf"],["class","custom-textarea form-control",3,"disabled","id","value",4,"ngIf"],[3,"ngStyle"],["type","number",1,"custom-input","form-control",3,"disabled","id","value"],["data-toggle","modal","data-target","#modal-detail",1,"fas","fa-eye",3,"click"],[1,"custom-textarea","form-control",3,"disabled","id","value"],[1,"table","table-sm","detail-table"],["colspan","2",2,"font-size","25px!important","text-transform","uppercase","text-align","center"],["colspan","2",2,"font-size","20px!important"]],template:function(e,n){1&e&&(t.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4,"Gestion M\xe9dicament Des ASC"),t.qZA(),t.TgZ(5,"div",4),t.YNc(6,kt,4,1,"div",5),t.TgZ(7,"div",6)(8,"form",7),t.NdJ("ngSubmit",function(){return n.initDataFilted()}),t.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"label"),t._uU(13,"Mois"),t.qZA(),t.YNc(14,Yt,2,1,"select",11),t.qZA()(),t.TgZ(15,"div",9)(16,"div",10)(17,"label"),t._uU(18,"Ann\xe9e"),t.qZA(),t.YNc(19,jt,2,1,"select",12),t.qZA()(),t.YNc(20,Ht,5,1,"div",13),t.YNc(21,zt,7,1,"div",13),t.YNc(22,Rt,7,1,"div",14),t.YNc(23,Wt,6,1,"div",13),t.YNc(24,te,13,0,"div",13),t.TgZ(25,"div",9)(26,"div",10)(27,"label",15),t._uU(28,"."),t.qZA(),t.TgZ(29,"button",16),t._uU(30," Charger les Donnees "),t._UZ(31,"span",17),t.qZA()()()()()()()(),t.TgZ(32,"div",18)(33,"div",1)(34,"div",19),t.YNc(35,ee,4,1,"h2",20),t.YNc(36,ne,4,0,"h2",20),t.qZA(),t.YNc(37,Pe,2,1,"div",20),t.qZA()()(),t.TgZ(38,"div",21)(39,"div",22)(40,"div",23)(41,"div",24)(42,"strong",25),t._uU(43,"D\xe9tail"),t.qZA(),t._UZ(44,"span",26),t.TgZ(45,"button",27)(46,"span",28),t._uU(47,"\xd7"),t.qZA()()(),t._UZ(48,"div",29),t.ALo(49,"safeHtml"),t.TgZ(50,"div",30),t._UZ(51,"p"),t.TgZ(52,"button",31),t._uU(53,"Fermer"),t.qZA()()()()(),t.TgZ(54,"div",32)(55,"div",22)(56,"div",23)(57,"div",24)(58,"strong",25),t._uU(59,"Patologies"),t.qZA(),t._UZ(60,"span",33),t.TgZ(61,"button",27)(62,"span",28),t._uU(63,"\xd7"),t.qZA()()(),t.TgZ(64,"div",34),t.YNc(65,Qe,6,3,"ng-container",20),t.qZA(),t.TgZ(66,"div",30),t._UZ(67,"p"),t.TgZ(68,"button",31),t._uU(69,"Fermer"),t.qZA()()()()()()),2&e&&(t.xp6(6),t.Q6J("ngIf",n.isLoading),t.xp6(2),t.Q6J("formGroup",n.chwsDrugDataForm),t.xp6(6),t.Q6J("ngIf",n.Months$.length>0),t.xp6(5),t.Q6J("ngIf",n.Years$.length>0),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(1),t.Q6J("ngIf",!n.roles.isChws()),t.xp6(5),t.Q6J("disabled",!n.chwsDrugDataForm.valid),t.xp6(6),t.Q6J("ngIf",""!=n.data_error_messages),t.xp6(1),t.Q6J("ngIf",1==n.data_no_data_found),t.xp6(1),t.Q6J("ngIf",""==n.data_error_messages&&n.OutputData$),t.xp6(11),t.Q6J("innerHTML",t.lcZ(49,15,n.dataDetail),t.oJD),t.xp6(17),t.Q6J("ngIf",n.OutputData$))},dependencies:[v.sg,v.O5,v.PC,_._Y,_.YN,_.Kr,_.EJ,_.JJ,_.JL,_.sg,_.u,v.Nd,St.z],styles:[".fa-times[_ngcontent-%COMP%]{color:red;font-size:25px}.fa-edit[_ngcontent-%COMP%]{color:orange;font-size:25px}.custom-input[_ngcontent-%COMP%]{width:125px!important;height:23px!important;margin:-2.5px 0 0!important;padding:14px 1px 14px 5px!important}.custom-textarea[_ngcontent-%COMP%]{width:200px!important;height:23px!important;margin:-2.5px 0 0!important;padding:14px 5px!important}.same-line[_ngcontent-%COMP%]{white-space:nowrap}.same-line[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .same-line[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .same-line[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:inline-block;vertical-align:top}.same-line[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;margin-left:2.5px}.same-line[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:130px!important;height:15px!important;overflow:hidden}.ajust-cells[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:265px!important}.ajust-cells[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:90px!important;height:0px!important}.submit-btn[_ngcontent-%COMP%]{min-width:200px!important;margin-right:20px;float:right}.card-title[_ngcontent-%COMP%]{width:100%!important}.chw-info[_ngcontent-%COMP%]{float:left!important}ul[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:0;overflow:hidden;float:right!important}li[_ngcontent-%COMP%]{background-color:#333;float:right}li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;color:#fff;text-align:center;padding:2px 5px;text-decoration:none;font-size:12px;cursor:pointer}li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{background-color:#111}.head-elem[_ngcontent-%COMP%]{background-color:#0ff}.head-elem[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center!important}.drug_thead[_ngcontent-%COMP%]{width:125px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px dashed rgb(177,177,177)}.out-data[_ngcontent-%COMP%]{color:#ff4500}.detail-table[_ngcontent-%COMP%]{margin:auto}.detail-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px dashed rgb(177,177,177)!important}.detail-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:1px dashed rgb(177,177,177)!important;background:rgb(0,0,67)!important;color:#fff!important}"]}),i})(),canActivate:[P.o],data:{href:"drug_per_selected",icon:"fa fa-user",label:"drug_per_selected",title:"Gestion M\xe9dicament ASC"}}];let Je=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[T.Bz.forChild($e),T.Bz]}),i})();var Fe=p(4466);let Se=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[v.ez,_.UX,Je,Fe.m]}),i})()}}]);