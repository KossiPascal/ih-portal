"use strict";(self.webpackChunkih_portal=self.webpackChunkih_portal||[]).push([[311],{311:(J,g,d)=>{d.r(g),d.d(g,{ChwsManageModule:()=>x});var u=d(8692),h=d(9841),m=d(8239),o=d(92),c=d(8629),p=d(574),t=d(4537),f=d(1383),w=d(3406),Z=d(7556),v=d(1815);function C(s,a){if(1&s&&(t.TgZ(0,"b",35)(1,"strong"),t._uU(2),t.qZA()()),2&s){const e=t.oxw();t.xp6(2),t.Oqu(e.message)}}function _(s,a){if(1&s&&(t.TgZ(0,"div",44),t._UZ(1,"i",45),t.TgZ(2,"div",46),t._uU(3),t.qZA()()),2&s){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function U(s,a){if(1&s&&(t.TgZ(0,"option",47),t._uU(1),t.qZA()),2&s){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function b(s,a){if(1&s&&(t.TgZ(0,"option",47),t._uU(1),t.qZA()),2&s){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function T(s,a){if(1&s){const e=t.EpF();t.TgZ(0,"tbody")(1,"tr",48),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.EditChwsZone(r))}),t.TgZ(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA()()()}if(2&s){const e=a.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(e.zone.name)}}function A(s,a){if(1&s&&(t.TgZ(0,"div",44),t._UZ(1,"i",45),t.TgZ(2,"div",46),t._uU(3),t.qZA()()),2&s){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function F(s,a){if(1&s&&(t.TgZ(0,"option",47),t._uU(1),t.qZA()),2&s){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function y(s,a){if(1&s&&(t.TgZ(0,"b",26)(1,"strong"),t._uU(2),t.qZA()()),2&s){const e=t.oxw();t.xp6(2),t.Oqu(e.message)}}function S(s,a){if(1&s&&(t.TgZ(0,"div",27),t._UZ(1,"i",28),t.TgZ(2,"div",29),t._uU(3),t.qZA()()),2&s){const e=t.oxw();t.xp6(3),t.Oqu(e.LoadingMsg)}}function q(s,a){if(1&s&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&s){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function M(s,a){if(1&s&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&s){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function N(s,a){if(1&s&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&s){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}const I=[{path:"",redirectTo:"replacements",pathMatch:"full"},{path:"replacements",component:(()=>{class s{constructor(e,i,n,r,l){this.store=e,this.db=i,this.auth=n,this.sync=r,this.router=l,this.District$=[],this.Sites$=[],this.Zones$=[],this.district$=[],this.sites$=[],this.replacementChws$=[],this.isLoginForm=!1,this.isLoading1=!1,this.isLoading2=!1,this.LoadingMsg="Loading...",this.isEditMode=!1,this.message="",this.roles=new p.G(this.store),this.roles.isSupervisorMentor()||(location.href=this.auth.userValue()?.defaultRedirectUrl)}activeSave(){throw new Error("Method not implemented.")}ngOnInit(){this.initAllData(),this.filterForm=this.createFilterFormGroup(),this.replacementChwsForm=this.createReplacementChwsFormGroup()}initAllData(){var e=this;return(0,m.Z)(function*(){e.sync.getDistrictsList().subscribe(i=>{200==i.status&&(e.District$=i.data),e.sync.getSitesList().subscribe(n=>{200==n.status&&(e.Sites$=n.data)},n=>console.log(n.error))},i=>console.log(i.error))})()}getReplacementChws(){this.isLoading1=!0;const e={districts:c.FI.returnDataAsArray(this.filterForm.value.districts),sites:c.FI.returnDataAsArray(this.filterForm.value.sites),withDhis2Data:!1};this.sync.getZonesList(e).subscribe(i=>{200==i.status&&(this.Zones$=i.data),this.sync.getChwsList(e).subscribe(n=>{if(this.replacementChws$=[],200==n.status)for(let r=0;r<n.data.length;r++){const l=n.data[r];l.name.includes("(R)")&&this.replacementChws$.push(l)}this.isLoading1=!1},n=>{console.log(n),this.isLoading1=!1})},i=>{console.log(i),this.isLoading1=!1})}EditChwsZone(e){this.message="",this.isEditMode=!0,this.replacementChwsForm=this.createReplacementChwsFormGroup(e),this.selectedChw(e)}selectedChw(e){this.chw=e}updateChwsFacilityIdAndContactPlace(){return this.isLoading2=!0,this.message="",this.db.updateUserFacilityContactPlace(this.replacementChwsForm.value).subscribe(e=>{this.message=e.message,this.getReplacementChws(),this.closeModal(),this.isLoading2=!1},e=>{this.message=e,this.isLoading2=!1,console.log(this.message)})}createFilterFormGroup(){return new o.cw({districts:new o.NI("",[o.kI.required]),sites:new o.NI("",[o.kI.required])})}createReplacementChwsFormGroup(e){return new o.cw({contact:new o.NI(null!=e?e.id:"",[o.kI.required]),parent:new o.NI(null!=e?e.zone.id:"",[o.kI.required]),new_parent:new o.NI("",[o.kI.required])},[this.MatchValidator("parent","new_parent")])}MatchValidator(e,i){return n=>{const r=n.get(e),l=n.get(i);return r&&l&&this.isEditMode&&r.value==l.value?{mismatch:!0}:null}}genarateSites(){const e=c.FI.returnDataAsArray(this.filterForm.value.districts);if(this.sites$=[],(0,c.Nf)(e))for(let i=0;i<this.Sites$.length;i++){const n=this.Sites$[i];(0,c.Nf)(n)&&e.includes(n.district.id)&&this.sites$.push(n)}else this.sites$=[]}showModalToast(e,i){showToast(e,i),this.closeModal("close-delete-modal")}closeModal(e="close-modal"){$("#"+e).trigger("click")}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.u),t.Y36(w.W),t.Y36(Z.e),t.Y36(v._),t.Y36(h.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-chws_manage"]],decls:87,vars:14,consts:[[1,"page-title","card","card-primary","card-outline"],[1,"card-body"],[1,"fas","fa-user",2,"float","left"],["class","login-box-msg",4,"ngIf"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-3","col-6"],[1,"form-group"],["formControlName","districts",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sites",1,"form-control"],[1,"col-sm-2","col-6"],["type","submit",1,"btn","btn-warning","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"page-content-wrap"],[1,"col-md-12"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],[1,"table","datatable"],[4,"ngFor","ngForOf"],["id","modal-default",1,"modal","fade"],[1,"modal-dialog"],["novalidate","",1,"form-horizontal",3,"formGroup","ngSubmit"],[1,"modal-content"],[1,"modal-header"],["height","30","src","assets/logo/logo.png","alt","","srcset","",1,"modal-title"],[1,"login-box-msg",2,"text-align","center"],[1,"btn-warning"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],["aria-hidden","true"],[1,"modal-body"],[1,"login-box-msg"],[1,"input-group","mb-3"],["id","new_parent","formControlName","new_parent",1,"form-control"],[1,"input-group-append"],[1,"input-group-text"],[1,"fas","fa-edit"],[1,"modal-footer","justify-content-between"],["id","close-modal","type","button","data-dismiss","modal",1,"btn","btn-default"],["type","submit",1,"btn","btn-warning",3,"disabled"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],[3,"value"],["data-toggle","modal","data-target","#modal-default",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"span",2),t._uU(3," List des ASC rempla\xe7antes"),t.qZA(),t._UZ(4,"br")(5,"br")(6,"br"),t.YNc(7,C,3,1,"b",3),t.TgZ(8,"div",4),t.YNc(9,_,4,1,"div",5),t.TgZ(10,"form",6),t.NdJ("ngSubmit",function(){return i.getReplacementChws()}),t.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"label"),t._uU(15,"District"),t.qZA(),t.TgZ(16,"select",10),t.NdJ("change",function(){return i.genarateSites()}),t._UZ(17,"option",11),t.YNc(18,U,2,2,"option",12),t.qZA()()(),t.TgZ(19,"div",8)(20,"div",9)(21,"label"),t._uU(22,"Site"),t.qZA(),t.TgZ(23,"select",13),t._UZ(24,"option",11),t.YNc(25,b,2,2,"option",12),t.qZA()()(),t.TgZ(26,"div",14)(27,"div",9)(28,"label"),t._uU(29,"."),t.qZA(),t.TgZ(30,"button",15),t._uU(31," OK "),t._UZ(32,"span",16),t.qZA()()()()()()()(),t.TgZ(33,"div",17)(34,"div",7)(35,"div",18)(36,"div",19),t._UZ(37,"div",20),t.TgZ(38,"div",21)(39,"table",22)(40,"thead")(41,"tr")(42,"th"),t._uU(43,"Nom de l'ASC"),t.qZA(),t.TgZ(44,"th"),t._uU(45,"Zone Actuel"),t.qZA()()(),t.YNc(46,T,6,2,"tbody",23),t.qZA()()()()()(),t.TgZ(47,"div",24)(48,"div",25)(49,"div",4),t.YNc(50,A,4,1,"div",5),t.TgZ(51,"form",26),t.NdJ("ngSubmit",function(){return i.updateChwsFacilityIdAndContactPlace()}),t.TgZ(52,"div",27)(53,"div",28),t._UZ(54,"img",29),t.TgZ(55,"strong",30)(56,"span",31),t._uU(57,"Modifier la zone"),t.qZA()(),t.TgZ(58,"button",32)(59,"span",33),t._uU(60,"\xd7"),t.qZA()()(),t.TgZ(61,"div",34)(62,"p",35)(63,"strong"),t._uU(64),t.qZA()(),t.TgZ(65,"p"),t._uU(66,"L'ASC remplacante "),t.TgZ(67,"strong"),t._uU(68),t.qZA(),t._uU(69," intervient pr\xe9sentement dans "),t.TgZ(70,"strong"),t._uU(71),t.qZA()(),t._UZ(72,"br"),t.TgZ(73,"p"),t._uU(74,"Selectionner une nouvelle zone d'intervention"),t.qZA(),t.TgZ(75,"div",36)(76,"select",37),t._UZ(77,"option",11),t.YNc(78,F,2,2,"option",12),t.qZA(),t.TgZ(79,"div",38)(80,"div",39),t._UZ(81,"span",40),t.qZA()()()(),t.TgZ(82,"div",41)(83,"button",42),t._uU(84,"Close"),t.qZA(),t.TgZ(85,"button",43),t._uU(86,"Modifier"),t.qZA()()()()()()()),2&e&&(t.xp6(7),t.Q6J("ngIf",""!=i.message),t.xp6(2),t.Q6J("ngIf",i.isLoading1),t.xp6(1),t.Q6J("formGroup",i.filterForm),t.xp6(8),t.Q6J("ngForOf",i.District$),t.xp6(7),t.Q6J("ngForOf",i.sites$),t.xp6(5),t.Q6J("disabled",!i.filterForm.valid),t.xp6(16),t.Q6J("ngForOf",i.replacementChws$),t.xp6(4),t.Q6J("ngIf",i.isLoading2),t.xp6(1),t.Q6J("formGroup",i.replacementChwsForm),t.xp6(13),t.Oqu(i.message),t.xp6(4),t.Oqu(null==i.chw?null:i.chw.name),t.xp6(3),t.Oqu(null==i.chw||null==i.chw.zone?null:i.chw.zone.name),t.xp6(7),t.Q6J("ngForOf",i.Zones$),t.xp6(7),t.Q6J("disabled",!i.replacementChwsForm.valid))},dependencies:[u.sg,u.O5,o._Y,o.YN,o.Kr,o.EJ,o.JJ,o.JL,o.sg,o.u],encapsulation:2}),s})(),data:{href:"replacements",icon:"fa fa-user",label:"Remplacants",title:"Remplacants"}},{path:"select_orgunit",component:(()=>{class s{constructor(e,i,n,r,l){this.store=e,this.db=i,this.auth=n,this.sync=r,this.router=l,this.District$=[],this.Sites$=[],this.Chws$=[],this.district$=[],this.sites$=[],this.chws$=[],this.isLoading=!1,this.LoadingMsg="Loading...",this.message="",this.roles=new p.G(this.store),this.chwOU=null,this.roles.isChws()||(location.href=this.auth.userValue()?.defaultRedirectUrl)}activeSave(){throw new Error("Method not implemented.")}ngOnInit(){this.chwOU=this.auth.chwsOrgUnit(),this.initAllData(),this.orgUnitForm=this.createFilterFormGroup()}initAllData(){var e=this;return(0,m.Z)(function*(){e.isLoading=!0,e.sync.getDistrictsList().subscribe(i=>{200==i.status&&(e.District$=i.data),e.sync.getSitesList().subscribe(n=>{200==i.status&&(e.Sites$=n.data),e.sync.getChwsList().subscribe(r=>{200==r.status&&(e.Chws$=r.data),null!=e.chwOU&&(e.genarateSites(!0),e.genarateChws(!0)),e.isLoading=!1},r=>{console.log(r),e.isLoading=!1})},n=>{console.log(n),e.isLoading=!1})},i=>{console.log(i),e.isLoading=!1})})()}createFilterFormGroup(){return new o.cw({districts:new o.NI(null!=this.chwOU?this.chwOU.site.district.id:"",[o.kI.required]),sites:new o.NI(null!=this.chwOU?this.chwOU.site.id:"",[o.kI.required]),chws:new o.NI(null!=this.chwOU?this.chwOU.id:"",[o.kI.required])})}genarateSites(e=!1){const n=c.FI.returnDataAsArray(e&&null!=this.chwOU?this.chwOU.site.district.id:this.orgUnitForm.value.districts);if(this.sites$=[],(0,c.Nf)(n))for(let r=0;r<this.Sites$.length;r++){const l=this.Sites$[r];(0,c.Nf)(l)&&n.includes(l.district.id)&&this.sites$.push(l)}else this.sites$=[]}genarateChws(e=!1){const n=c.FI.returnDataAsArray(e&&null!=this.chwOU?this.chwOU.site.id:this.orgUnitForm.value.sites);if(this.chws$=[],this.orgUnitForm.value.chws="",(0,c.Nf)(n))for(let r=0;r<this.Chws$.length;r++){const l=this.Chws$[r];(0,c.Nf)(l)&&n.includes(l.site.id)&&this.chws$.push(l)}else this.chws$=[]}getChwInfo(e){for(let i=0;i<this.chws$.length;i++){const n=this.chws$[i];if(e.includes(n.id))return n}return null}updateChwsOrgUnit(){const e=this.orgUnitForm.value.chws,i=this.getChwInfo(c.FI.returnDataAsArray((0,c.Nf)(e)?e:this.chwOU.id));null!=i&&(0,c.Nf)(i)?(localStorage.removeItem("chw_found"),this.store.set("chw_found",JSON.stringify(i)),location.href=c.FI.getSavedUrl()??this.auth.userValue()?.defaultRedirectUrl):this.message="Erreur, veullez r\xe9\xe9ssayer ou contacter le superviseur!"}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(f.u),t.Y36(w.W),t.Y36(Z.e),t.Y36(v._),t.Y36(h.F0))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-chw_select_orgunit"]],decls:52,vars:7,consts:[[1,"page-title","card","card-primary","card-outline"],[1,"card-body"],[2,"text-align","center","font-weight","bold","font-size","large"],["class","login-box-msg",4,"ngIf"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-3","col-1"],[1,"col-sm-6","col-10"],[1,"col-sm-12","col-12"],[1,"form-group"],["formControlName","districts",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sites",1,"form-control",3,"change"],["formControlName","chws",1,"form-control"],[1,"col-sm-3","col-3"],[1,"col-sm-6","col-6"],["type","submit",1,"btn","btn-warning","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"page-content-wrap"],[1,"col-md-12"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],[1,"login-box-msg"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],[3,"value"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Choisir district, site et code "),t.qZA(),t._UZ(4,"br")(5,"br"),t.YNc(6,y,3,1,"b",3),t.TgZ(7,"div",4),t.YNc(8,S,4,1,"div",5),t.TgZ(9,"form",6),t.NdJ("ngSubmit",function(){return i.updateChwsOrgUnit()}),t.TgZ(10,"div",7),t._UZ(11,"div",8),t.TgZ(12,"div",9)(13,"div",7)(14,"div",10)(15,"div",11)(16,"label"),t._uU(17,"District"),t.qZA(),t.TgZ(18,"select",12),t.NdJ("change",function(){return i.genarateSites()}),t._UZ(19,"option",13),t.YNc(20,q,2,2,"option",14),t.qZA()()(),t.TgZ(21,"div",10)(22,"div",11)(23,"label"),t._uU(24,"Site"),t.qZA(),t.TgZ(25,"select",15),t.NdJ("change",function(){return i.genarateChws()}),t._UZ(26,"option",13),t.YNc(27,M,2,2,"option",14),t.qZA()()(),t.TgZ(28,"div",10)(29,"div",11)(30,"label"),t._uU(31,"Asc"),t.qZA(),t.TgZ(32,"select",16),t._UZ(33,"option",13),t.YNc(34,N,2,2,"option",14),t.qZA()()(),t.TgZ(35,"div",10)(36,"div",7),t._UZ(37,"div",17),t.TgZ(38,"div",18)(39,"div",11),t._UZ(40,"br"),t.TgZ(41,"button",19),t._uU(42," Valider "),t._UZ(43,"span",20),t.qZA()()(),t._UZ(44,"div",17),t.qZA()()()(),t._UZ(45,"div",8),t.qZA()()()()(),t.TgZ(46,"div",21)(47,"div",7)(48,"div",22)(49,"div",23),t._UZ(50,"div",24)(51,"div",25),t.qZA()()()()),2&e&&(t.xp6(6),t.Q6J("ngIf",""!=i.message),t.xp6(2),t.Q6J("ngIf",i.isLoading),t.xp6(1),t.Q6J("formGroup",i.orgUnitForm),t.xp6(11),t.Q6J("ngForOf",i.District$),t.xp6(7),t.Q6J("ngForOf",i.sites$),t.xp6(7),t.Q6J("ngForOf",i.chws$),t.xp6(7),t.Q6J("disabled",!i.orgUnitForm.valid))},dependencies:[u.sg,u.O5,o._Y,o.YN,o.Kr,o.EJ,o.JJ,o.JL,o.sg,o.u],encapsulation:2}),s})(),data:{href:"select_orgunit",icon:"fa fa-user",label:"Choisir OrgUnit",title:"Choisir OrgUnit"}}];let L=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[h.Bz.forChild(I),h.Bz]}),s})(),x=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[u.ez,o.UX,L]}),s})()}}]);