"use strict";(self.webpackChunkih_portal=self.webpackChunkih_portal||[]).push([[545],{5545:(M,Z,r)=>{r.r(Z),r.d(Z,{DatabaseUtilsModule:()=>$});var h=r(8692),p=r(3580),d=r(8239),n=r(92),l=r(8629),t=r(4537),T=r(1815),b=r(7556),_=r(3406);function v(i,a){if(1&i&&(t.TgZ(0,"div",32),t._UZ(1,"i",33),t.TgZ(2,"div",34),t._uU(3),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.initMsg,"")}}function U(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function F(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function C(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function y(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function L(i,a){if(1&i&&(t.TgZ(0,"option",35),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.s9C("value",e),t.xp6(1),t.hij(" ",e.toUpperCase()," ")}}function A(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",36),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.deleteSelectedDataFromCouchDb())}),t._uU(1," Delete Selected Data From CouchDb "),t.qZA()}}function w(i,a){if(1&i&&(t.TgZ(0,"tbody")(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA()()()),2&i){const e=a.$implicit;t.xp6(3),t.Oqu(e.id),t.xp6(2),t.Oqu(e.rev),t.xp6(2),t.Oqu(e.zone.name),t.xp6(2),t.Oqu(e.site.name)}}const N=[{path:"",component:(()=>{class i{constructor(e,s,o,u){this.sync=e,this.auth=s,this.dbUtils=o,this.router=u,this.responseMsg="",this.foundedDataToDelete=[],this.selectedListToBeDelete=[],this.Districts$=[],this.Sites$=[],this.Zones$=[],this.Chws$=[],this.sites$=[],this.zones$=[],this.chws$=[],this.types$=["data","patients","families"],this.constMsg="Loading...",this.initMsg=this.constMsg}dataListToDeleteFilterFormGroup(){return new n.cw({start_date:new n.NI("",[n.kI.required,n.kI.minLength(7)]),end_date:new n.NI("",[n.kI.required,n.kI.minLength(7)]),sources:new n.NI("Tonoudayo",[n.kI.required]),districts:new n.NI("",[n.kI.required]),sites:new n.NI("",[n.kI.required]),zones:new n.NI("",[n.kI.required]),chws:new n.NI("",[n.kI.required]),type:new n.NI("",[n.kI.required])})}ngOnInit(){this.dataListToDeleteForm=this.dataListToDeleteFilterFormGroup(),this.initAllData()}initAllData(){var e=this;return(0,d.Z)(function*(){e.isLoading=!0,e.initMsg="Chargement des Districts ...",e.sync.getDistrictsList().subscribe(function(){var s=(0,d.Z)(function*(o){200==o.status&&(e.Districts$=o.data),e.initMsg="Chargement des Sites ...",e.sync.getSitesList().subscribe(function(){var u=(0,d.Z)(function*(c){200==c.status&&(e.Sites$=c.data),e.initMsg="Chargement des Zones ...",e.sync.getZonesList().subscribe(function(){var g=(0,d.Z)(function*(f){200==f.status&&(e.Zones$=f.data),e.initMsg="Chargement des ASC ...",e.sync.getChwsList().subscribe(function(){var m=(0,d.Z)(function*(D){200==D.status&&(e.Chws$=D.data),e.isLoading=!1});return function(D){return m.apply(this,arguments)}}(),m=>{e.isLoading=!1,console.log(m.error)})});return function(f){return g.apply(this,arguments)}}(),g=>{e.isLoading=!1,console.log(g.error)})});return function(c){return u.apply(this,arguments)}}(),u=>{e.isLoading=!1,console.log(u.error)})});return function(o){return s.apply(this,arguments)}}(),s=>{e.isLoading=!1,console.log(s.error)})})()}TruncateBd(){var e=this;this.initMsg=this.constMsg,this.isLoading=!0,this.dbUtils.truncateDatabase({procide:!0}).subscribe(function(){var s=(0,d.Z)(function*(o){e.responseMsg=o.data.toString(),e.isLoading=!1});return function(o){return s.apply(this,arguments)}}(),s=>{console.log(s.error),this.isLoading=!1,this.responseMsg=s.toString()})}getListOfDataToDeleteFromCouchDb(){var e=this;this.initMsg=this.constMsg,this.isLoading=!0,this.foundedDataToDelete=[],this.selectedListToBeDelete=[],this.dbUtils.getDataToDeleteFromCouchDb(this.ParamsToFilter()).subscribe(function(){var s=(0,d.Z)(function*(o){if(200==o.status){e.foundedDataToDelete=o.data;for(let u=0;u<e.foundedDataToDelete.length;u++){const c=e.foundedDataToDelete[u];e.selectedListToBeDelete.push({_deleted:!0,_id:c.id,_rev:c.rev})}}else e.responseMsg=o.data;e.isLoading=!1});return function(o){return s.apply(this,arguments)}}(),s=>{console.log(s.error),this.isLoading=!1,this.responseMsg=s.toString()})}deleteSelectedDataFromCouchDb(){var e=this;this.initMsg=this.constMsg,this.selectedListToBeDelete.length>0?this.dbUtils.deleteDataFromCouchDb(this.selectedListToBeDelete,this.dataListToDeleteForm.value.type).subscribe(function(){var s=(0,d.Z)(function*(o){200==o.status?(e.responseMsg="Done successfuly !",e.foundedDataToDelete=[],e.selectedListToBeDelete=[]):e.responseMsg="Problem with query, retry!"});return function(o){return s.apply(this,arguments)}}(),s=>{console.log(s),this.responseMsg="Error found when deleting ..."}):this.responseMsg="Not data provied!"}ParamsToFilter(){return{start_date:this.dataListToDeleteForm.value.start_date,end_date:this.dataListToDeleteForm.value.end_date,sources:l.F.returnDataAsArray(this.dataListToDeleteForm.value.sources),districts:l.F.returnDataAsArray(this.dataListToDeleteForm.value.districts),sites:l.F.returnDataAsArray(this.dataListToDeleteForm.value.sites),zones:l.F.returnDataAsArray(this.dataListToDeleteForm.value.zones),chws:l.F.returnDataAsArray(this.dataListToDeleteForm.value.chws),type:this.dataListToDeleteForm.value.type}}genarateSites(){this.sites$=[],this.zones$=[],this.chws$=[];const e=this.dataListToDeleteForm.value.districts;if(this.dataListToDeleteForm.value.sites="",this.dataListToDeleteForm.value.chws="",l.F.notNull(e))for(let s=0;s<this.Sites$.length;s++){const o=this.Sites$[s];l.F.notNull(o)&&e==o.district.id&&this.sites$.push(o)}else this.sites$=[]}genarateZones(){this.zones$=[],this.chws$=[];const e=this.dataListToDeleteForm.value.sites;if(this.dataListToDeleteForm.value.zones="",this.dataListToDeleteForm.value.chws="",l.F.notNull(e))for(let s=0;s<this.Zones$.length;s++){const o=this.Zones$[s];l.F.notNull(e)&&e==o.site.id&&this.zones$.push(o)}else this.zones$=[]}genarateChws(){this.chws$=[];const e=this.dataListToDeleteForm.value.zones;if(this.dataListToDeleteForm.value.chws="",l.F.notNull(e))for(let s=0;s<this.Chws$.length;s++){const o=this.Chws$[s];l.F.notNull(o)&&e==o.zone.id&&this.chws$.push(o)}else this.chws$=[]}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(T._),t.Y36(b.e),t.Y36(_.W),t.Y36(p.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-user"]],decls:83,vars:11,consts:[[1,"page-title","card","card-primary","card-outline"],[1,"card-body"],["type","button",1,"btn","btn-danger",3,"click"],[2,"color","red"],[1,"content-header"],[1,"container-fluid"],[1,"card","card-info"],[1,"overlay-wrapper"],["class","overlay",4,"ngIf"],[1,"card-header"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-3","col-6"],[1,"form-group"],["type","date","formControlName","start_date",1,"form-control"],["type","date","formControlName","end_date",1,"form-control"],["formControlName","districts",1,"form-control",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","sites",1,"form-control",3,"change"],["formControlName","zones",1,"form-control",3,"change"],["formControlName","chws",1,"form-control"],["formControlName","type",1,"form-control"],[1,"col-sm-2","col-6"],["type","submit",1,"btn","btn-warning","form-control",3,"disabled"],[1,"fa","fa-floppy-o","fa-right"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],["type","button","class","btn btn-warning",3,"click",4,"ngIf"],[1,"table","datatable"],[4,"ngFor","ngForOf"],[1,"overlay"],[1,"fas","fa-3x","fa-sync-alt","fa-spin"],[1,"text-bold","pt-2"],[3,"value"],["type","button",1,"btn","btn-warning",3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return s.TruncateBd()}),t._uU(3," Truncate Progres database "),t.qZA()()(),t.TgZ(4,"h1",3),t._uU(5),t.qZA(),t.TgZ(6,"section",4)(7,"div",5)(8,"div",6)(9,"div",7),t.YNc(10,v,4,1,"div",8),t.TgZ(11,"div",9)(12,"form",10),t.NdJ("ngSubmit",function(){return s.getListOfDataToDeleteFromCouchDb()}),t.TgZ(13,"div",11)(14,"div",12)(15,"div",13)(16,"label"),t._uU(17,"Date D\xe9but"),t.qZA(),t._UZ(18,"input",14),t.qZA()(),t.TgZ(19,"div",12)(20,"div",13)(21,"label"),t._uU(22,"Date Fin"),t.qZA(),t._UZ(23,"input",15),t.qZA()(),t.TgZ(24,"div",12)(25,"div",13)(26,"label"),t._uU(27,"District"),t.qZA(),t.TgZ(28,"select",16),t.NdJ("change",function(){return s.genarateSites()}),t._UZ(29,"option",17),t.YNc(30,U,2,2,"option",18),t.qZA()()(),t.TgZ(31,"div",12)(32,"div",13)(33,"label"),t._uU(34,"Site"),t.qZA(),t.TgZ(35,"select",19),t.NdJ("change",function(){return s.genarateZones()}),t._UZ(36,"option",17),t.YNc(37,F,2,2,"option",18),t.qZA()()(),t.TgZ(38,"div",12)(39,"div",13)(40,"label"),t._uU(41,"Zone"),t.qZA(),t.TgZ(42,"select",20),t.NdJ("change",function(){return s.genarateChws()}),t._UZ(43,"option",17),t.YNc(44,C,2,2,"option",18),t.qZA()()(),t.TgZ(45,"div",12)(46,"div",13)(47,"label"),t._uU(48,"Chw"),t.qZA(),t.TgZ(49,"select",21),t._UZ(50,"option",17),t.YNc(51,y,2,2,"option",18),t.qZA()()(),t.TgZ(52,"div",12)(53,"div",13)(54,"label"),t._uU(55,"Type"),t.qZA(),t.TgZ(56,"select",22),t._UZ(57,"option",17),t.YNc(58,L,2,2,"option",18),t.qZA()()(),t.TgZ(59,"div",23)(60,"div",13)(61,"label"),t._uU(62,"."),t.qZA(),t.TgZ(63,"button",24),t._uU(64," OK "),t._UZ(65,"span",25),t.qZA()()()()()()(),t.TgZ(66,"div",26),t._UZ(67,"div",27),t.TgZ(68,"div",28),t.YNc(69,A,2,0,"button",29),t._UZ(70,"br"),t.TgZ(71,"table",30)(72,"thead")(73,"tr")(74,"th"),t._uU(75,"ID"),t.qZA(),t.TgZ(76,"th"),t._uU(77,"REV"),t.qZA(),t.TgZ(78,"th"),t._uU(79,"Zone Name"),t.qZA(),t.TgZ(80,"th"),t._uU(81,"Site"),t.qZA()()(),t.YNc(82,w,10,4,"tbody",31),t.qZA()()()()()()),2&e&&(t.xp6(5),t.hij(" ",s.responseMsg," "),t.xp6(5),t.Q6J("ngIf",s.isLoading),t.xp6(2),t.Q6J("formGroup",s.dataListToDeleteForm),t.xp6(18),t.Q6J("ngForOf",s.Districts$),t.xp6(7),t.Q6J("ngForOf",s.sites$),t.xp6(7),t.Q6J("ngForOf",s.zones$),t.xp6(7),t.Q6J("ngForOf",s.chws$),t.xp6(7),t.Q6J("ngForOf",s.types$),t.xp6(5),t.Q6J("disabled",!s.dataListToDeleteForm.valid),t.xp6(6),t.Q6J("ngIf",s.selectedListToBeDelete.length>0),t.xp6(13),t.Q6J("ngForOf",s.foundedDataToDelete))},dependencies:[h.sg,h.O5,n._Y,n.YN,n.Kr,n.Fj,n.EJ,n.JJ,n.JL,n.sg,n.u],encapsulation:2}),i})(),data:{href:"truncate_db",icon:"fa fa-user",label:"DatabaseUtils",title:"DatabaseUtils"}}];let q=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[p.Bz.forChild(N),p.Bz]}),i})(),$=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[h.ez,n.UX,q]}),i})()}}]);